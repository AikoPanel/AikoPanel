import{i as N,j as t,B as j,bO as he,a4 as Z,aa as F,k as y,ab as J,al as z,r as h,at as f,z as me,ag as fe,o as d,p as be,au as xe,t as we,as as Ce,ar as ye,s as ke,aj as m,T as C,cj as ve,F as T,ak as B,cb as Se,bw as ee,bx as te,bd as je,be as Ie,bf as $,by as ne,c7 as Me,c8 as A,bs as Be,bg as Oe,c9 as Ee,ca as _e,bi as Le,c4 as re,bm as ae,cd as se,a3 as Te,C as Ne,bh as De,bj as $e,bR as Ae,bW as Re,c3 as Fe,aL as x,aH as ze,aG as Ge,bC as W,ck as He,cl as Pe,cm as Qe,cn as q,co as We,bv as qe,bD as Y,a6 as U,a9 as V,bB as X}from"./vendor-4c8effbd.js";import{V as Ye,W as Ue,X as Ve,Y as Xe,m as I,Z as Ke,M as G,S as oe,_ as Ze,c as Je,j as et,A as K}from"./index-efdad191.js";import{u as tt}from"./useQuery-4151a8eb.js";const nt=({color:e,size:n,variant:a,sx:l})=>{const s=N(),c=Ye(s,e||"primary"),{main:p}=c;return t(j,{component:"span",sx:{width:n||8,height:n||8,borderRadius:"50%",bgcolor:a==="outlined"?"":p,...a==="outlined"&&{border:`1px solid ${p}`},...l}})},rt=({id:e})=>{var H;const n=N(),a=Z(n.breakpoints.down("lg")),{enqueueSnackbar:l}=F(),{t:s}=y(),c=tt(),p=J(),[g,u]=z(!1),[i,o]=h.useState(e!=null?e:0),[r,w]=h.useState((H=c.get("s"))!=null?H:""),[b,E]=h.useState(""),[_,D]=h.useState(null);h.useEffect(()=>{a||u.set(!0)},[a]);const ie=h.useMemo(()=>a?280:320,[a]),k=Ue(void 0,{pollingInterval:1e3*60}),ce=Ve(i,{skip:i===0,pollingInterval:1e3*30}),[le]=Xe();h.useEffect(()=>{i&&(E(""),D(null))},[i]),h.useEffect(()=>{var v,L;k.data&&((L=(v=k.data)==null?void 0:v.length)!=null?L:0)>0&&!i&&(o(k.data[0].id),p(`/ticket/${k.data[0].id}`))},[k.data]);const de=async()=>{if(b.trim()===""){l(s("notice::send-message",{context:"empty"}),{variant:"warning"});return}try{await le({id:i,message:b}).unwrap(),l(s("notice::send-message",{context:"success"}),{variant:"success"}),E(""),D(null)}catch(v){console.error("error sending message",v),l(s("notice::send-message",{context:"failed"}),{variant:"error"}),D(v.message)}};return{tickets:h.useMemo(()=>{var v,L;return(L=(v=k.data)==null?void 0:v.filter(ue=>{let P=!0;const pe=["subject"];let Q=!1;return pe.forEach(ge=>{ue[ge].toString().toLowerCase().includes(r.toString().toLowerCase())&&(Q=!0)}),Q||(P=!1),P}))!=null?L:[]},[k.data,r]),ticketsQuery:k,ticketQuery:ce,currentId:i,setCurrentId:o,drawerOpen:g,drawerActions:u,drawerWidth:ie,search:r,setSearch:w,messageInput:b,setMessageInput:E,handleOnSend:de,errorMessage:_}},[It,M]=he(rt);var O=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(O||{}),R=(e=>(e[e.Replied=0]="Replied",e[e.Pending=1]="Pending",e))(R||{}),S=(e=>(e[e.Low=0]="Low",e[e.Medium=1]="Medium",e[e.High=2]="High",e))(S||{});const at={[0]:"low",[1]:"medium",[2]:"high"},st=I()(e=>({listItemButton:{paddingLeft:e.spacing(1)},text:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},iconAvatar:{width:e.spacing(4.5),height:e.spacing(4.5),fontSize:"1rem"}})),ot=()=>{const{t:e}=y(),n=N(),{tickets:a,currentId:l,setCurrentId:s}=M(),{classes:c,css:p,cx:g}=st(),u=J(),i=h.useCallback((r,w)=>{const b=f().diff(f.unix(r),"second");switch(!0){case b<60:return e(w,{context:"just_now"});case b<3600:return e(w,{context:"minute",count:f().diff(f.unix(r),"minute")});case b<86400:return e(w,{context:"hour",count:f().diff(f.unix(r),"hour")});case b<2592e3:return e(w,{context:"day",count:f().diff(f.unix(r),"day")});case b<31536e3:return e(w,{context:"month",count:f().diff(f.unix(r),"month")});default:return e(w,{context:"year",count:f().diff(f.unix(r),"year")})}},[e]),o=h.useCallback(r=>{switch(r){case S.Low:default:return p({color:n.palette.success.main,backgroundColor:n.palette.success.lighter});case S.Medium:return p({color:n.palette.warning.main,backgroundColor:n.palette.warning.lighter});case S.High:return p({color:n.palette.error.main,backgroundColor:n.palette.error.lighter})}},[n.palette,p]);return t(me,{component:"nav",children:a.map(r=>t(fe,{disablePadding:!0,divider:!0,children:d(be,{className:c.listItemButton,selected:r.id===l,onClick:()=>{s(r.id),u(`/ticket/${r.id}`)},children:[t(xe,{children:t(we,{className:g(o(r.level),c.iconAvatar),children:r.reply_status===R.Replied?t(Ce,{}):t(ye,{})})}),t(ke,{primary:d(m,{component:"span",direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,children:[t(C,{variant:"h5",color:"inherit",className:c.text,children:r.subject}),t(C,{component:"span",color:"textSecondary",variant:"caption",children:e("ticket.drawer.reply_status",{context:r.status===O.Closed?"closed":r.reply_status===R.Replied?"replied":"pending"})})]}),secondary:d(m,{component:"span",direction:"row",alignItems:"center",justifyContent:"space-between",spacing:1,children:[t(C,{variant:"caption",color:"textSecondary",className:c.text,children:i(r.updated_at,"ticket.drawer.updated_at")}),r.status===O.Open?t(nt,{color:"primary"}):t(ve,{style:{color:n.palette.primary.main}})]})})]})},r.id))})},it=I()(e=>({root:{padding:e.spacing(2,0),backgroundColor:"transparent"}})),ct=()=>{const{t:e}=y(),[n,{set:a}]=z(!1),[l]=Ke(),{classes:s}=it(),c=h.useCallback(async(p,{setSubmitting:g,setStatus:u,setErrors:i})=>{console.log(p),g(!0);try{await l(p).unwrap(),a(!1),u({success:!0})}catch(o){console.error("error creating ticket",o),u({success:!1}),i(o.errors||{submit:o.message})}finally{g(!1)}},[]);return d(T,{children:[t(B,{onClick:()=>a(!0),children:t(Se,{})}),d(ee,{open:n,onClose:()=>a(!1),fullWidth:!0,children:[t(te,{children:e("ticket.drawer.create_dialog.title")}),t(je,{initialValues:{subject:"",message:"",level:S.Low},validationSchema:Ie().shape({subject:$().required(e("ticket.drawer.create_dialog.subject",{context:"required"}).toString()),message:$().required(e("ticket.drawer.create_dialog.message",{context:"required"}).toString()),level:$().required(e("ticket.drawer.create_dialog.level",{context:"required"}).toString())}),onSubmit:c,children:({handleSubmit:p,handleBlur:g,handleChange:u,values:i,touched:o,errors:r,submitForm:w,isSubmitting:b,resetForm:E})=>d(T,{children:[t(ne,{children:d(m,{component:Me,onSubmit:p,className:s.root,spacing:2,children:[t(A,{name:"subject",value:i.subject,onChange:u,onBlur:g,error:o.subject&&Boolean(r.subject),helperText:o.subject&&r.subject,label:e("ticket.drawer.create_dialog.subject",{context:"label"}),fullWidth:!0}),d(Be,{fullWidth:!0,children:[t(Oe,{htmlFor:"level-select",children:e("ticket.drawer.create_dialog.level",{context:"label"})}),t(Ee,{id:"level-select",name:"level",value:i.level,onChange:u,onBlur:g,error:o.level&&Boolean(r.level),label:e("ticket.drawer.create_dialog.level",{context:"label"}),fullWidth:!0,children:[S.Low,S.Medium,S.High].map(_=>t(_e,{component:"option",value:_,children:e("ticket.drawer.create_dialog.level",{context:_})},_))}),o.level&&r.level&&t(Le,{error:o.level&&Boolean(r.level),children:o.level&&r.level})]}),t(A,{name:"message",value:i.message,onChange:u,onBlur:g,error:o.message&&Boolean(r.message),helperText:o.message&&r.message,label:e("ticket.drawer.create_dialog.message",{context:"label"}),rows:4,multiline:!0,fullWidth:!0})]})}),d(re,{children:[t(ae,{type:"reset",disabled:b,onClick:()=>{E(),a(!1)},children:e("ticket.drawer.create_dialog.cancel",{context:"button"})}),t(se,{loading:b,onClick:w,type:"submit",variant:"contained",children:e("ticket.drawer.create_dialog.submit",{context:"button"})})]})]})})]})]})},lt=I()((e,{drawerWidth:n})=>({drawer:{width:n,zIndex:e.zIndex.drawer,[e.breakpoints.up("lg")]:{zIndex:0},display:"flex",flexDirection:"column",flexShrink:0,flexGrow:1},drawerPaper:{width:n,boxSizing:"border-box",position:"relative",border:"none"},mainCard:{[e.breakpoints.down("lg")]:{backgroundColor:"transparent"},borderRadius:e.spacing(.5,0,0,.5),borderRight:"none"},mainCardContainer:{padding:e.spacing(3),paddingBottom:e.spacing(1)},titleChip:{width:20,height:20,borderRadius:"50%","& .MuiChip-label":{padding:e.spacing(.5,0)}},searchInput:{padding:e.spacing(1.3125,0,1.5),color:e.palette.text.primary}})),dt=()=>{var o;const{t:e}=y(),n=N(),{drawerWidth:a,drawerOpen:l,drawerActions:{set:s},search:c,setSearch:p,ticketsQuery:{data:g}}=M(),u=Z(n.breakpoints.down("lg")),{classes:i}=lt({drawerWidth:a});return t(Te,{className:i.drawer,classes:{paper:i.drawerPaper},variant:u?"temporary":"persistent",anchor:"left",open:l,ModalProps:{keepMounted:!0},onClose:()=>s(!1),children:l&&d(G,{className:i.mainCard,border:!u,content:!1,children:[t(j,{className:i.mainCardContainer,children:d(m,{spacing:2,children:[d(m,{direction:"row",spacing:1,alignItems:"center",justifyContent:"space-between",children:[d(m,{direction:"row",spacing:1,alignItems:"center",children:[t(C,{variant:"h5",color:"inherit",children:e("ticket.drawer.title")}),t(Ne,{label:(o=g==null?void 0:g.filter(r=>r.status===O.Open).length)!=null?o:0,component:"span",color:"secondary",className:i.titleChip})]}),t(m,{direction:"row",alignItems:"center",justifyContent:"flex-end",children:t(ct,{})})]}),t(De,{fullWidth:!0,id:"input-search-header",placeholder:e("ticket.drawer.search",{context:"placeholder"}).toString(),value:c,onChange:r=>{p(r.target.value)},sx:{"& .MuiOutlinedInput-input":{p:"10.5px 0px 12px",color:"darkgray"}},startAdornment:t($e,{position:"start",children:t(Ae,{style:{fontSize:"small"}})})})]})}),t(oe,{sx:{overflowX:"hidden",height:u?"calc(100vh - 120px)":"calc(100vh - 428px)",minHeight:u?0:420},children:t(j,{sx:{p:3,pt:0},children:t(ot,{})})})]})})},ut=()=>{const{t:e}=y(),[n,{set:a}]=z(!1),{enqueueSnackbar:l}=F(),{ticketQuery:{data:s}}=M(),[c,{isLoading:p}]=Ze(),g=h.useCallback(async()=>{if(s)try{await c(s.id).unwrap(),l(e("notice::close-ticket",{context:"success"}),{variant:"success"}),a(!1)}catch(u){console.error("error closing ticket",u),l(e("notice::close-ticket",{context:"failed"}),{variant:"error"})}},[e,s]);return d(T,{children:[t(B,{onClick:()=>a(!0),children:t(Re,{})}),d(ee,{open:n,onClose:()=>a(!1),children:[t(te,{children:e("ticket.header.close_dialog.title")}),t(ne,{children:t(Fe,{children:e("ticket.header.close_dialog.content")})}),d(re,{children:[t(ae,{onClick:()=>a(!1),children:e("ticket.header.close_dialog.cancel-button")}),t(se,{onClick:g,loading:p,variant:"contained",color:"error",children:e("ticket.header.close_dialog.confirm-button")})]})]})]})},pt=I()(e=>({root:{backgroundColor:e.palette.background.paper,paddingRight:e.spacing(2),paddingBottom:e.spacing(2),borderBottom:`1px solid ${e.palette.divider}`}})),gt=()=>{const{t:e}=y(),{drawerOpen:n,drawerActions:{toggle:a},currentId:l,ticketQuery:{data:s,isFetching:c}}=M(),{classes:p}=pt();return d(x,{container:!0,justifyContent:"space-between",className:p.root,children:[t(x,{item:!0,children:d(m,{direction:"row",alignItems:"center",spacing:1,children:[t(B,{onClick:()=>a(),color:"secondary",size:"large",children:n?t(ze,{}):t(Ge,{})}),d(m,{children:[t(C,{variant:"subtitle1",children:s&&!c?e("ticket.header.title",{id:s.id,subject:s.subject}):t(W,{variant:"text",width:200})}),t(C,{variant:"caption",color:"textSecondary",children:s&&!c?e("ticket.header.ticket_level",{context:at[s.level]}):t(W,{variant:"text",width:80})})]})]})}),t(x,{item:!0,children:t(m,{direction:"row",alignItems:"center",justifyContent:"flex-end",spacing:1,children:(s==null?void 0:s.status)===O.Open&&t(ut,{})})})]})},ht=I()(e=>({iconButton:{opacity:.5},card:{borderRadius:e.spacing(1)}})),mt=()=>{const{setMessageInput:e}=M(),n=N(),[a,l]=h.useState(null),s=i=>{l(a?null:i==null?void 0:i.currentTarget)},c=i=>{e(o=>o+i.emoji),g()},p=h.useMemo(()=>Boolean(a),[a]),g=()=>{l(null)},{classes:u}=ht();return d(T,{children:[t(B,{ref:a,"aria-describedby":"emoji-selector",onClick:s,className:u.iconButton,size:"medium",color:"secondary",children:t(He,{})}),t(Pe,{id:"emoji-selector",open:p,anchorEl:a,disablePortal:!0,anchorOrigin:{vertical:"center",horizontal:"right"},onClose:()=>g(),children:t(G,{elevation:8,content:!1,className:u.card,children:t(Qe,{onEmojiClick:c,lazyLoadEmojis:!0,autoFocusSearch:!0,theme:n.palette.mode==="dark"?q.DARK:q.LIGHT,emojiStyle:We.APPLE,getEmojiUrl:i=>{var o;return((o=Je.emojiEndpoint)!=null?o:"https://cdn.jsdelivr.net/npm/emoji-datasource-apple/img/apple/64/{{code}}.png").replace("{{code}}",i)}})})})]})},ft=I()(e=>({root:{backgroundColor:e.palette.background.paper,borderTop:`1px solid ${e.palette.divider}`,padding:e.spacing(2),height:"auto"},textField:{paddingRight:e.spacing(2),"& .MuiInput-root:before":{borderBottomColor:e.palette.divider}}})),bt=()=>{const{t:e}=y(),{messageInput:n,setMessageInput:a,handleOnSend:l}=M(),{classes:s}=ft(),c=h.useRef(null),p=u=>{switch(u.key){case"Enter":u.ctrlKey?a(n+`
`):l()}};h.useEffect(()=>{c.current&&c.current.addEventListener("keypress",p)},[c.current]);const g=u=>{let i=u.target.value;a(i)};return d(m,{className:s.root,children:[t(A,{inputRef:c,className:s.textField,rows:4,placeholder:e("ticket.input-area.input",{context:"placeholder"}).toString(),value:n,onChange:g,variant:"standard",fullWidth:!0,multiline:!0}),d(m,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[t(m,{direction:"row",sx:{py:2,ml:-1},children:t(mt,{})}),t(B,{color:"primary",onClick:l,size:"large",sx:{mr:1.5},children:t(qe,{})})]})]})},xt=I()(e=>({root:{overflowX:"hidden"},rootBox:{paddingLeft:e.spacing(1),paddingRight:e.spacing(3)},userMessageCard:{display:"inline-block",float:"right",bgcolor:e.palette.primary.main,boxShadow:"none"},serverMessageCard:{display:"inline-block",float:"left",backgroundColor:e.palette.mode==="dark"?e.palette.background.paper:e.palette.grey[0],boxShadow:"none"},cardContent:{padding:e.spacing(1.25),paddingBottom:`${e.spacing(1.25)} !important`,width:"fit-content",marginLeft:"auto","& > p":{marginBottom:0}},textBlock:{"& > p":{color:e.palette.primary.contrastText,marginBottom:0}}})),wt=()=>{const{t:e}=y(),{classes:n}=xt(),{enqueueSnackbar:a}=F(),{ticketQuery:{data:l}}=M(),{data:s}=et(),c=h.useRef(document.createElement("div")),p=h.useCallback(()=>{c.current.scrollIntoView(!1)},[c.current]);h.useEffect(()=>{p()},[l==null?void 0:l.message.length,p]);const g=h.useCallback(o=>()=>{window.navigator.clipboard.writeText(o).then(()=>{a(e("notice::copy",{context:"success"}),{variant:"success"})}).catch(r=>{console.error("Failed to copy:",r),a(e("notice::copy",{context:"error"}),{variant:"error"})})},[a,e]),u=({message:o})=>d(m,{direction:"row",spacing:1.25,children:[d(x,{container:!0,spacing:1,justifyContent:"flex-end",children:[t(x,{item:!0,xs:2,md:3,xl:4}),t(x,{item:!0,xs:10,md:9,xl:8,children:d(m,{direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:1,children:[t(B,{size:"small",onClick:g(o.message),children:t(Y,{})}),t(U,{className:n.userMessageCard,children:t(V,{className:n.cardContent,children:t(X,{children:o.message})})})]})}),t(x,{item:!0,xs:12,children:t(C,{align:"right",variant:"subtitle2",color:"textSecondary",children:f.unix(o.created_at).format("DD/MM/YYYY HH:mm")})})]}),t(K,{alt:s==null?void 0:s.email,src:s==null?void 0:s.avatar_url})]}),i=({message:o})=>d(m,{direction:"row",spacing:1.25,alignItems:"flex-start",children:[t(K,{alt:"server",color:"secondary"}),d(x,{container:!0,children:[t(x,{item:!0,xs:12,sm:7,children:d(m,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[t(U,{className:n.serverMessageCard,children:t(V,{className:n.cardContent,children:t(X,{children:o.message})})}),t(B,{size:"small",onClick:g(o.message),children:t(Y,{})})]})}),t(x,{item:!0,xs:12,sx:{mt:1},children:t(C,{align:"left",variant:"subtitle2",color:"textSecondary",children:f.unix(o.created_at).format("DD/MM/YYYY HH:mm")})})]})]});return t(oe,{className:n.root,children:t(j,{className:n.rootBox,children:t(m,{spacing:2.5,ref:c,direction:"column",children:l==null?void 0:l.message.map((o,r)=>o.is_me?t(u,{message:o},r):t(i,{message:o},r))})})})},Ct=I()((e,{drawerOpen:n,drawerWidth:a})=>({root:{transition:e.transitions.create("margin",{easing:n?e.transitions.easing.easeOut:e.transitions.easing.sharp,duration:e.transitions.duration.shorter}),marginLeft:n?0:-a,width:n?`calc(100% - ${a}px)`:"100%",[e.breakpoints.down("lg")]:{paddingLeft:0,marginLeft:0},display:"flex",flexDirection:"column",flexWrap:"wrap",flexGrow:1},mainCard:{backgroundColor:e.palette.mode==="dark"?e.palette.background.paper:e.palette.grey[50],paddingTop:e.spacing(2),borderRadius:e.spacing(0,.5,.5,0),borderLeft:"none",height:"100%"},centerBox:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1,height:"100%"}})),yt=()=>{const{t:e}=y(),{drawerOpen:n,drawerWidth:a,currentId:l,ticketQuery:{data:s}}=M(),{classes:c}=Ct({drawerOpen:n,drawerWidth:a});return t(j,{className:c.root,children:t(x,{container:!0,flexGrow:1,children:t(x,{item:!0,xs:12,children:t(G,{content:!1,className:c.mainCard,children:t(m,{spacing:3,direction:"column",height:"100%",children:l===0?t(j,{className:c.centerBox,children:t(C,{variant:"h5",children:e("ticket.conversation.none_selected")})}):d(T,{children:[t(gt,{}),t(j,{flexGrow:1,children:t(wt,{})}),(s==null?void 0:s.status)===O.Open&&t(bt,{})]})})})})})})},Mt=()=>d(j,{display:"flex",flexDirection:"row",flexWrap:"nowrap",flexGrow:"1",children:[t(dt,{}),t(yt,{})]});export{It as T,Mt as a};
