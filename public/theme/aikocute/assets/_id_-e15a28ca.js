import{bO as I,r as l,aa as w,k as x,o as p,j as e,T as b,bB as _,aj as C,bC as O,z as A,ag as M,p as T,bd as V,B as j,bh as Y,bj as D,ax as R,ak as B,bU as q,bV as Q,bi as $,ab as F,be as H,bq as W,bf as N,a8 as G,bm as U,aL as m,bN as z}from"./vendor-4c8effbd.js";import{q as J,M as L,r as K,s as X,b as Z}from"./index-efdad191.js";import{a as ee,g as E}from"./plan-c051bc74.js";import{a as v}from"./plan-357bf2a6.js";const ne=({id:t})=>{const n=J(t),[i,d]=l.useState(null),[a,f]=l.useState(!1),[r,o]=l.useState(null);l.useEffect(()=>{n.data&&!i&&d(ee(n.data))},[n.data,i]);const c=l.useMemo(()=>{if(!n.data||!i)return 0;const g=E(n.data)[i];return g?g/100:0},[n.data,i]),u=l.useMemo(()=>r?r.type===1?c-r.value/100:r.type===2?c*(1-r.value/100):0:c,[r,c]),{enqueueSnackbar:s}=w();return l.useEffect(()=>{n.error&&s(n.error.message,{variant:"error"})},[n.error,s]),{id:t,originPrice:c,price:u,planQuery:n,period:i,setPeriod:d,isSubmitting:a,setIsSubmitting:f,couponCode:r,setCouponCode:o}},[te,k]=I(ne),re=()=>{const{t}=x(),{planQuery:{data:n,isLoading:i}}=k();return p(L,{title:t("subscription.plan.plan-info-card.title",{name:n==null?void 0:n.name}),content:!1,children:[n&&e(b,{variant:"body1",paragraph:!0,component:"div",children:e(_,{children:n.content})}),i&&e(C,{p:2,spacing:1,children:Array.from(new Array(3)).map((d,a)=>e(O,{variant:"text",width:"100%",height:20},a))})]})},ie=()=>{const{t}=x(),{planQuery:{data:n},setPeriod:i,period:d,isSubmitting:a}=k(),f=l.useMemo(()=>n?Object.keys(E(n)):[],[n]);return e(L,{title:t("subscription.plan.period-select-card.title"),content:!1,children:e(A,{sx:{p:0},children:n&&f.map(r=>e(M,{divider:!0,disablePadding:!0,children:e(T,{onClick:o=>{o.preventDefault(),i(r)},selected:r===d,disabled:a,children:p(C,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,width:"100%",py:1.5,children:[e(b,{variant:"subtitle1",children:t("subscription.plan.period-select-card.period",{context:r})}),e(b,{variant:"subtitle1",children:t("subscription.plan.period-select-card.price",{price:((E(n)[r]||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})})]})})},r))})})},ae=()=>{const{t}=x(),[n,{isLoading:i}]=K(),{setIsSubmitting:d,isSubmitting:a,id:f,setCouponCode:r,couponCode:o}=k();return l.useEffect(()=>{d(i)},[i,d]),e(L,{title:t("subscription.plan.coupon-card.title"),children:e(V,{initialValues:{coupon:(o==null?void 0:o.code)||""},onSubmit:async(c,{setSubmitting:u,setStatus:s,setErrors:g,setValues:S})=>{if(o){S({coupon:""}),r(null);return}u(!0),await n({code:c.coupon,plan_id:f}).unwrap().then(y=>{r(y),u(!1),s({success:!0})}).catch(y=>{u(!1),s({success:!1}),g(y.errors||{coupon:y.message})})},children:({values:c,handleChange:u,handleSubmit:s,handleBlur:g,errors:S,touched:y})=>p(j,{component:"form",onSubmit:s,children:[e(Y,{fullWidth:!0,name:"coupon",placeholder:t("subscription.plan.coupon-card.placeholder").toString(),disabled:a||o!==null,onChange:u,onBlur:g,value:o!==null?o.code:c.coupon,endAdornment:e(D,{position:"end",children:e(R,{title:t("subscription.plan.coupon-card.tooltip",{context:o!==null?"reset":"add"}).toString(),placement:"bottom",children:e(B,{edge:"end",type:"submit",children:o!==null?e(q,{}):e(Q,{})})})})}),y.coupon&&S.coupon&&e($,{error:!0,children:S.coupon})]})})})},oe=()=>{const{t}=x(),{planQuery:{data:n},originPrice:i,price:d,couponCode:a,setIsSubmitting:f,isSubmitting:r,period:o}=k(),[c,{isLoading:u}]=X();l.useEffect(()=>{f(u)},[u,f]);const{enqueueSnackbar:s}=w(),g=F(),S=H().shape({plan_id:W().required(t("notice::data-not-loaded").toString()),period:N().oneOf([v.ONETIME,v.MONTHLY,v.QUARTERLY,v.HALF_YEARLY,v.YEARLY,v.TWO_YEARLY,v.THREE_YEARLY]).required(t("notice::period-not-selected").toString()),coupon_code:N().nullable()}),y=()=>{const P={plan_id:n==null?void 0:n.id,coupon_code:a==null?void 0:a.code,period:o};S.isValid(P).then(()=>{c({plan_id:P.plan_id,coupon_code:P.coupon_code,period:P.period}).unwrap().then(h=>{console.log("order created:",h),s(t("notice::order-created").toString(),{variant:"success"}),g(`/order/${h}`)}).catch(h=>{console.error(h),s(h.message,{variant:"error"})})}).catch(h=>{console.error(h),s(`${h.name}: ${Array.from(h.errors).join(", ")}`,{variant:"error"})})};return e(L,{title:t("subscription.plan.order-info-card.title"),children:p(C,{spacing:2,divider:e(G,{}),children:[n&&p(C,{direction:"row",justifyContent:"space-between",spacing:1,children:[e(b,{variant:"body1",children:n==null?void 0:n.name}),e(b,{variant:"body1",children:t("subscription.plan.order-info-card.price",{price:Number(i).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})})]}),a&&p(C,{direction:"row",justifyContent:"space-between",spacing:1,children:[e(b,{variant:"body1",children:t("subscription.plan.order-info-card.coupon",{name:a.name})}),e(b,{variant:"body1",children:t("subscription.plan.order-info-card.price",{price:Number(a.type===1?a.value/100*-1:a.value/100*-1*i).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})})]}),p(C,{direction:"column",spacing:2,children:[e(b,{variant:"subtitle1",children:t("subscription.plan.order-info-card.total")}),e(b,{variant:"h2",component:"span",children:t("subscription.plan.order-info-card.price",{price:Number(d).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}),e(U,{fullWidth:!0,variant:"contained",color:"primary",onClick:y,disabled:r,children:t("subscription.plan.order-info-card.button")})]})]})})},ce=()=>p(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,md:8,children:p(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,children:e(re,{})}),e(m,{item:!0,xs:12,children:e(ie,{})})]})}),e(m,{item:!0,xs:12,md:4,children:p(m,{container:!0,spacing:2,children:[e(m,{item:!0,xs:12,children:e(ae,{})}),e(m,{item:!0,xs:12,children:e(oe,{})})]})})]}),pe=()=>{Z("buy-plan");const t=z().id,n=l.useMemo(()=>t&&parseInt(t)||0,[t]);return e(te,{id:n,children:e(ce,{})})};export{pe as default};
