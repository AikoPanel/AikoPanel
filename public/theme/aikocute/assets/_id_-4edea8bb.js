import{r as d,a9 as N,k as x,o as p,j as e,T as b,ai as C,bJ as I,z as _,af as A,p as M,B as O,bd as T,bf as V,aw as Y,aj as j,cd as D,ce as R,be as B,aa as Q,a7 as q,bi as F,aK as h,bW as $}from"./vendor-894d6afa.js";import{q as H,M as L,r as W,s as G,b as z}from"./index-33033ac6.js";import{c as J}from"./constate.es-202c99c0.js";import{a as K,g as k}from"./plan-68b71785.js";import{E as U}from"./index.es-8e82e15c.js";import{F as X,c as Z,d as ee,a as w}from"./formik.esm-4935cab4.js";import{a as v}from"./plan-357bf2a6.js";const ne=({id:r})=>{const n=H(r),[i,l]=d.useState(null),[o,f]=d.useState(!1),[t,a]=d.useState(null);d.useEffect(()=>{n.data&&!i&&l(K(n.data))},[n.data,i]);const c=d.useMemo(()=>{if(!n.data||!i)return 0;const g=k(n.data)[i];return g?g/100:0},[n.data,i]),u=d.useMemo(()=>t?t.type===1?c-t.value/100:t.type===2?c*(1-t.value/100):0:c,[t,c]),{enqueueSnackbar:s}=N();return d.useEffect(()=>{n.error&&s(n.error.message,{variant:"error"})},[n.error,s]),{id:r,originPrice:c,price:u,planQuery:n,period:i,setPeriod:l,isSubmitting:o,setIsSubmitting:f,couponCode:t,setCouponCode:a}},[re,E]=J(ne),te=()=>{const{t:r}=x(),{planQuery:{data:n,isLoading:i}}=E();return p(L,{title:r("subscription.plan.plan-info-card.title",{name:n==null?void 0:n.name}),content:!1,children:[n&&e(b,{variant:"body1",paragraph:!0,component:"div",children:e(U,{children:n.content})}),i&&e(C,{p:2,spacing:1,children:Array.from(new Array(3)).map((l,o)=>e(I,{variant:"text",width:"100%",height:20},o))})]})},ie=()=>{const{t:r}=x(),{planQuery:{data:n},setPeriod:i,period:l,isSubmitting:o}=E(),f=d.useMemo(()=>n?Object.keys(k(n)):[],[n]);return e(L,{title:r("subscription.plan.period-select-card.title"),content:!1,children:e(_,{sx:{p:0},children:n&&f.map(t=>e(A,{divider:!0,disablePadding:!0,children:e(M,{onClick:a=>{a.preventDefault(),i(t)},selected:t===l,disabled:o,children:p(C,{direction:"row",alignItems:"center",justifyContent:"space-between",spacing:2,width:"100%",py:1.5,children:[e(b,{variant:"subtitle1",children:r("subscription.plan.period-select-card.period",{context:t})}),e(b,{variant:"subtitle1",children:r("subscription.plan.period-select-card.price",{price:((k(n)[t]||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})})]})})},t))})})},oe=()=>{const{t:r}=x(),[n,{isLoading:i}]=W(),{setIsSubmitting:l,isSubmitting:o,id:f,setCouponCode:t,couponCode:a}=E();return d.useEffect(()=>{l(i)},[i,l]),e(L,{title:r("subscription.plan.coupon-card.title"),children:e(X,{initialValues:{coupon:(a==null?void 0:a.code)||""},onSubmit:async(c,{setSubmitting:u,setStatus:s,setErrors:g,setValues:S})=>{if(a){S({coupon:""}),t(null);return}u(!0),await n({code:c.coupon,plan_id:f}).unwrap().then(y=>{t(y),u(!1),s({success:!0})}).catch(y=>{u(!1),s({success:!1}),g(y.errors||{coupon:y.message})})},children:({values:c,handleChange:u,handleSubmit:s,handleBlur:g,errors:S,touched:y})=>p(O,{component:"form",onSubmit:s,children:[e(T,{fullWidth:!0,name:"coupon",placeholder:r("subscription.plan.coupon-card.placeholder").toString(),disabled:o||a!==null,onChange:u,onBlur:g,value:a!==null?a.code:c.coupon,endAdornment:e(V,{position:"end",children:e(Y,{title:r("subscription.plan.coupon-card.tooltip",{context:a!==null?"reset":"add"}).toString(),placement:"bottom",children:e(j,{edge:"end",type:"submit",children:a!==null?e(D,{}):e(R,{})})})})}),y.coupon&&S.coupon&&e(B,{error:!0,children:S.coupon})]})})})},ae=()=>{const{t:r}=x(),{planQuery:{data:n},originPrice:i,price:l,couponCode:o,setIsSubmitting:f,isSubmitting:t,period:a}=E(),[c,{isLoading:u}]=G();d.useEffect(()=>{f(u)},[u,f]);const{enqueueSnackbar:s}=N(),g=Q(),S=Z().shape({plan_id:ee().required(r("notice::data-not-loaded").toString()),period:w().oneOf([v.ONETIME,v.MONTHLY,v.QUARTERLY,v.HALF_YEARLY,v.YEARLY,v.TWO_YEARLY,v.THREE_YEARLY]).required(r("notice::period-not-selected").toString()),coupon_code:w().nullable()}),y=()=>{const P={plan_id:n==null?void 0:n.id,coupon_code:o==null?void 0:o.code,period:a};S.isValid(P).then(()=>{c({plan_id:P.plan_id,coupon_code:P.coupon_code,period:P.period}).unwrap().then(m=>{console.log("order created:",m),s(r("notice::order-created").toString(),{variant:"success"}),g(`/order/${m}`)}).catch(m=>{console.error(m),s(m.message,{variant:"error"})})}).catch(m=>{console.error(m),s(`${m.name}: ${Array.from(m.errors).join(", ")}`,{variant:"error"})})};return e(L,{title:r("subscription.plan.order-info-card.title"),children:p(C,{spacing:2,divider:e(q,{}),children:[n&&p(C,{direction:"row",justifyContent:"space-between",spacing:1,children:[e(b,{variant:"body1",children:n==null?void 0:n.name}),e(b,{variant:"body1",children:r("subscription.plan.order-info-card.price",{price:Number(i).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})})]}),o&&p(C,{direction:"row",justifyContent:"space-between",spacing:1,children:[e(b,{variant:"body1",children:r("subscription.plan.order-info-card.coupon",{name:o.name})}),e(b,{variant:"body1",children:r("subscription.plan.order-info-card.price",{price:Number(o.type===1?o.value/100*-1:o.value/100*-1*i).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})})]}),p(C,{direction:"column",spacing:2,children:[e(b,{variant:"subtitle1",children:r("subscription.plan.order-info-card.total")}),e(b,{variant:"h2",component:"span",children:r("subscription.plan.order-info-card.price",{price:Number(l).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}),e(F,{fullWidth:!0,variant:"contained",color:"primary",onClick:y,disabled:t,children:r("subscription.plan.order-info-card.button")})]})]})})},ce=()=>p(h,{container:!0,spacing:2,children:[e(h,{item:!0,xs:12,md:8,children:p(h,{container:!0,spacing:2,children:[e(h,{item:!0,xs:12,children:e(te,{})}),e(h,{item:!0,xs:12,children:e(ie,{})})]})}),e(h,{item:!0,xs:12,md:4,children:p(h,{container:!0,spacing:2,children:[e(h,{item:!0,xs:12,children:e(oe,{})}),e(h,{item:!0,xs:12,children:e(ae,{})})]})})]}),be=()=>{z("buy-plan");const r=$().id,n=d.useMemo(()=>r&&parseInt(r)||0,[r]);return e(re,{id:n,children:e(ce,{})})};export{be as default};
