System.register(["./vendor-legacy-21e846b5.js","./index-legacy-4d5357df.js","./order-legacy-457a0b92.js","./plan-legacy-fc8ce824.js"],(function(e,r){"use strict";var t,c,a,n,o,d,i,l,s,u,h,m,p,b,g,y,v,f,N,k,D,E,x,S,_,M,I,L,w,Y,C,A,P,V,T,H,G,R,j,O,F,z,U,W,q,$;return{setters:[e=>{t=e.bO,c=e.k,a=e.aa,n=e.r,o=e.at,d=e.j,i=e.aL,l=e.o,s=e.bC,u=e.b$,h=e.c0,m=e.c1,p=e.aj,b=e.T,g=e.al,y=e.c2,v=e.F,f=e.ax,N=e.ak,k=e.bW,D=e.bw,E=e.bx,x=e.a8,S=e.by,_=e.c3,M=e.c4,I=e.bm,L=e.a$,w=e.c5,Y=e.z,C=e.ag,A=e.p,P=e.s,V=e.au,T=e.bN},e=>{H=e.w,G=e.x,R=e.y,j=e.M,O=e.m,F=e.v,z=e.A,U=e.z,W=e.b},e=>{q=e.O},e=>{$=e.a}],execute:function(){const[r,B]=t((({tradeNo:e})=>{const{t:r}=c(),{enqueueSnackbar:t}=a(),[o,d]=n.useState(q.PENDING),[i,l]=n.useState(!1),s=H(e),u=G(e,{skip:o!==q.PENDING&&o!==q.PAID||!s.isSuccess,pollingInterval:1e3}),h=R(void 0,{skip:o!==q.PENDING||!s.isSuccess}),[m,p]=n.useState(0),b=n.useMemo((()=>new Map(h.data?.map((e=>[e.id,e])))),[h.data]);return n.useEffect((()=>{0===m&&h.isSuccess&&h.data.length>0&&p(h.data[0].id)}),[h.isSuccess,m,h.data]),n.useEffect((()=>{s.data?.status&&d(s.data.status)}),[s.data?.status]),n.useEffect((()=>{u.data&&d(u.data)}),[u.data]),n.useEffect((()=>{s.error&&t(r("notice::order-detail-error",{error:s.error.message}),{variant:"error"})}),[s.error]),{tradeNo:e,status:o,detail:s,callback:u,paymentMethod:h,paymentMethodIndex:b,paymentMethodState:m,setPaymentMethodState:p,isSubmitting:i,setSubmitting:l}})),Q=()=>{const{t:e}=c(),{detail:{data:r,isLoading:t}}=B(),a=n.useMemo((()=>{const e=o.unix(r?.created_at||0);switch(r?.period){case $.ONEDAY:return e.add(1,"day");case $.MONTHLY:return e.add(1,"month");case $.BIMONTHLY:return e.add(2,"month");case $.QUARTERLY:return e.add(3,"month");case $.HALF_YEARLY:return e.add(6,"month");case $.YEARLY:return e.add(1,"year");case $.TWO_YEARLY:return e.add(2,"year");case $.THREE_YEARLY:return e.add(3,"year");default:return e}}),[r?.created_at,r?.period]),u=n.useMemo((()=>[{label:e("order.checkout.product-info-card.product-name"),value:r?.plan.name},{label:e("order.checkout.product-info-card.product-type"),value:e("order.checkout.product-info-card.product-period",{context:r?.period})},{label:e("order.checkout.product-info-card.traffic"),value:e("order.checkout.product-info-card.traffic",{count:r?.plan.transfer_enable||0,context:null===r?.plan.transfer_enable?"unlimited":"limited"})},...r?.period===$.ONETIME?[]:[{label:e("order.checkout.product-info-card.next-billing-date"),value:a.format("DD/MM/YYYY")}]]),[r,e,a]);return d(j,{title:e("order.checkout.product-info-card.title"),children:d(i,{container:!0,spacing:1,children:u.map(((e,r)=>d(i,{item:!0,xs:12,children:l(i,{container:!0,spacing:2,children:[d(i,{item:!0,xs:4,children:e.label}),d(i,{item:!0,xs:8,children:t?d(s,{variant:"text",width:"100%"}):e.value})]})},r)))})})},J=O()(((e,{status:r})=>({root:{padding:e.spacing(1)},icon:{fontSize:e.spacing(8),color:e.palette[r===q.FINISHED?"success":"warning"].main}}))),K=()=>{const{t:e}=c(),{status:r}=B(),{classes:t}=J({status:r}),a=n.useMemo((()=>{switch(r){case q.FINISHED:return d(u,{className:t.icon});case q.CANCELLED:return d(m,{className:t.icon});case q.PENDING:return d(h,{className:t.icon});case q.DEDUCTED:return d(u,{className:t.icon});default:return null}}),[r]),o=n.useMemo((()=>{switch(r){case q.FINISHED:return"finished";case q.CANCELLED:return"cancelled";case q.PAID:return"paid";case q.DEDUCTED:return"deducted";default:return null}}),[r]);return d(j,{className:t.root,children:l(p,{direction:"column",spacing:3,children:[a,l(p,{direction:"column",spacing:1,alignItems:"center",children:[d(b,{variant:"h3",children:e("order.checkout.status-card.status",{context:o})}),d(b,{variant:"body1",color:"textSecondary",align:"center",children:e("order.checkout.status-card.description",{context:o})})]})]})})},X=()=>{const{t:e}=c(),[r,{setLeft:t,setRight:n}]=g(!1),{tradeNo:o}=B(),[i]=F(),{enqueueSnackbar:s}=a(),u=y((async()=>{try{const r=await i(o).unwrap();r?(s(e("notice::order-cancel_success"),{variant:"success"}),L.event("order_cancel",{category:"order",label:"cancel",tradeNo:o,success:!0})):(s(e("notice::order-cancel_failed"),{variant:"error"}),L.event("order_cancel",{category:"order",label:"cancel",tradeNo:o,success:!1,error:r}))}catch(r){s(e("notice::order-cancel_failed"),{variant:"error"}),L.event("order_cancel",{category:"order",label:"cancel",tradeNo:o,success:!1,error:r})}t()}));return l(v,{children:[d(f,{title:e("order.checkout.order-info-card.cancel-tooltip"),placement:"top",children:d(N,{onClick:n,children:d(k,{})})}),l(D,{open:r,onClose:t,children:[d(E,{children:d(p,{direction:"row",alignItems:"center",spacing:1.5,children:d(b,{variant:"inherit",children:e("order.checkout.order-info-card.cancel-dialog.title")})})}),d(x,{}),d(S,{children:d(_,{children:e("order.checkout.order-info-card.cancel-dialog.content")})}),l(M,{children:[d(I,{onClick:t,children:e("order.checkout.order-info-card.cancel-dialog.cancel-button")}),d(I,{variant:"contained",color:"primary",onClick:u,children:e("order.checkout.order-info-card.cancel-dialog.confirm-button")})]})]})]})},Z=()=>{const{t:e}=c(),{detail:{data:r,isLoading:t},status:a}=B(),u=n.useMemo((()=>{switch(a){case q.FINISHED:return"paid";case q.CANCELLED:return"cancelled";case q.PENDING:return"pending";case q.DEDUCTED:return"deducted";default:return null}}),[a]),h=n.useMemo((()=>[{label:e("order.checkout.order-info-card.order-number"),value:r?.trade_no},{label:e("order.checkout.order-info-card.order-date"),value:o.unix(r?.created_at||0).format("DD-MM-YYYY HH:mm:ss")},{label:e("order.checkout.order-info-card.order-status"),value:e("order.checkout.order-info-card.order-status-value",{context:u})},...r?.discount_amount?[{label:e("order.checkout.order-info-card.coupon-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.discount_amount||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],...r?.surplus_amount?[{label:e("order.checkout.order-info-card.subscription-deduct-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.surplus_amount||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],{label:e("order.checkout.order-info-card.order-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.total_amount||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]),[r,e]);return d(j,{title:e("order.checkout.order-info-card.title"),secondary:a===q.PENDING&&d(X,{}),children:d(i,{container:!0,spacing:2,children:h.map(((e,r)=>d(i,{item:!0,xs:12,children:l(i,{container:!0,spacing:2,children:[d(i,{item:!0,xs:4,children:e.label}),d(i,{item:!0,xs:8,children:d(b,{variant:"body1",noWrap:!0,children:t?d(s,{variant:"text",width:"100%"}):e.value})})]})},r)))})})},ee=O()((e=>({icon:{fontSize:e.spacing(2.5)}}))),re=()=>{const{t:e}=c(),{paymentMethod:{isLoading:r},detail:{isLoading:t},paymentMethodIndex:a,paymentMethodState:o,setPaymentMethodState:i,isSubmitting:u}=B(),h=n.useMemo((()=>Array.from(a.values())),[a]),{classes:m}=ee(),p=n.useCallback((({icon:e})=>!0===e.includes("alipay")?d(z,{type:"combined",children:d(w,{className:m.icon})}):d(z,{type:"combined",color:"secondary",src:e})),[]),b=e=>r=>{r.preventDefault(),i(e.id),L.event("select",{category:"order",label:"payment_method",method:a.get(e.id)?.name,method_id:e.id})};return d(j,{title:e("order.checkout.payment-method-card.title"),content:!1,children:d(Y,{sx:{p:0},children:r||t?Array.from(new Array(3)).map(((e,r)=>d(C,{disablePadding:!0,divider:!0,children:d(A,{disabled:!0,children:d(P,{children:d(s,{variant:"text",width:100})})})},r))):h.length>0?h.map((e=>d(C,{disablePadding:!0,divider:!0,children:l(A,{selected:o===e.id,disabled:u,onClick:b(e),onTouchEnd:b(e),children:[e.icon&&d(V,{children:d(p,{icon:e.icon})}),d(P,{children:e.name})]})},e.id))):d(v,{children:d(P,{sx:{m:1.8},children:e("notice::no-payment-method")})})})})},te=()=>{const{t:e}=c(),{detail:{data:r,isLoading:t},paymentMethodState:o,paymentMethodIndex:i,setSubmitting:u,isSubmitting:h,paymentMethod:m}=B(),[g]=U(),{enqueueSnackbar:y}=a(),v=n.useMemo((()=>[{label:r?.plan.name,value:e("order.checkout.billing-card.price",{value:Number((r?.plan[r?.period]??0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})},...r?.discount_amount||r?.surplus_amount?[{label:e("order.checkout.billing-card.deduction"),value:e("order.checkout.billing-card.price",{value:(((r?.discount_amount??0)+(r?.surplus_amount??0))/-100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],{label:e("order.checkout.billing-card.total-price"),value:e("order.checkout.billing-card.price",{value:Number((r?.total_amount??0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]),[r,e]),f=n.useCallback((async t=>{if(t.preventDefault(),r&&o)try{u(!0),L.event("click",{category:"order",label:"checkout",method:i.get(o)?.name,method_id:o}),window.location.href=await g({trade_no:r.trade_no,method:o}).unwrap()}catch(c){y(e("notice::checkout-failed"),{variant:"error"}),L.event("click",{category:"order",label:"checkout",method:i.get(o)?.name,method_id:o,success:!1,error:c})}finally{u(!1)}else y(e("notice::data-not-loaded"),{variant:"error"})}),[g,r,o]);return d(j,{title:e("order.checkout.billing-card.title"),children:l(p,{spacing:2,divider:d(x,{}),children:[v.map(((e,r)=>t?d(s,{variant:"text",width:"100%",height:40},r):l(p,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[d(b,{variant:"body1",children:e.label}),d(b,{variant:"body1",children:e.value})]},r))),d(I,{fullWidth:!0,variant:"contained",disabled:t||h||0==m.data?.length,onClick:f,children:e("order.checkout.billing-card.button")})]})})},ce=()=>{const{status:e}=B();return l(i,{container:!0,spacing:2,children:[d(i,{item:!0,xs:!0,children:l(i,{container:!0,spacing:2,children:[e!==q.PENDING&&d(i,{item:!0,xs:12,children:d(K,{})}),d(i,{item:!0,xs:12,children:d(Q,{})}),d(i,{item:!0,xs:12,children:d(Z,{})}),e===q.PENDING&&d(i,{item:!0,xs:12})]})}),e===q.PENDING&&d(i,{item:!0,xs:12,md:4,children:l(i,{container:!0,spacing:2,children:[d(i,{item:!0,xs:12,children:d(re,{})}),d(i,{item:!0,xs:12,children:d(te,{})})]})})]})};e("default",(()=>{W("checkout");const e=T().id;return d(r,{tradeNo:e||"",children:d(ce,{})})}))}}}));
