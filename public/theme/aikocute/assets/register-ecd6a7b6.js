import{i as Q,bb as U,aa as N,k as V,a9 as J,r as v,j as e,F as P,a_ as A,l as I,B as R,o,aK as a,ai as _,bc as w,ao as m,bd as y,be as g,bf as X,bg as Y,bh as Z,bs as C,T as S,bt as ee,bu as re,aH as T,m as F,bi as ie,ap as te}from"./vendor-894d6afa.js";import{A as ae}from"./AuthWrapper-a2b9dc7c.js";import{c as se,a as b,b as ne,d as W,F as oe}from"./formik.esm-4935cab4.js";import{S as le,O as de,s as ce,a as me}from"./password-strength-dc897e1e.js";import{d as pe,e as ue,I as he,b as ge}from"./index-33033ac6.js";import{A as _e}from"./AnimateButton-c09ecc76.js";import{u as we}from"./useQuery-32cc74cd.js";import"./hey-listen.es-3d38fef0.js";const be=()=>{var B;const u=Q(),M=U(),O=N(),{t}=V("common"),{enqueueSnackbar:$}=J(),k=we(),[j]=pe(),{data:r}=ue(),[d,E]=v.useState(),[x,L]=v.useState(!1),D=()=>{L(!x)},G=i=>{i.preventDefault()},q=i=>{const n=ce(i);E(me(n))};v.useEffect(()=>{q("")},[]);const z=v.useMemo(()=>se().shape({email:b().email(t("register.email_invalid").toString()).max(255,t("register.email_max",{count:255}).toString()).required(t("register.email_required").toString()),password:b().min(8,t("register.password_min",{count:8}).toString()).max(255,t("register.password_max",{count:255}).toString()).required(t("register.password_required").toString()),password_confirm:b().oneOf([ne("password"),null],t("register.password_confirm_invalid").toString()).required(t("register.password_confirm_required").toString()),invite_code:r!=null&&r.is_invite_force?b().max(8,t("register.invite_code_max").toString()).required(t("register.invite_code_required").toString()):b().max(8,t("register.invite_code_max").toString()),email_code:r!=null&&r.is_email_verify?W().max(6,t("register.email_code_max").toString()).required(t("register.email_code_required").toString()):W().negative()}),[t,r==null?void 0:r.is_invite_force,r==null?void 0:r.is_email_verify]);return e(P,{children:e(oe,{initialValues:{email:"",password:"",password_confirm:"",invite_code:(B=k.get("code"))!=null?B:"",email_code:"",agree:!1,submit:null},validationSchema:z,onSubmit:async(i,{setErrors:n,setStatus:l,setSubmitting:f})=>{if(!i.agree){l({success:!1}),n({submit:t("register.agree_required").toString()}),f(!1);return}try{await j({email:i.email,password:i.password,invite_code:i.invite_code,email_code:r!=null&&r.is_email_verify?i.email_code:""}).unwrap().then(()=>{l({success:!0}),$(t("notice::register_success"),{variant:"success"}),O("/dashboard",{replace:!0}),A.event("register",{category:"auth",label:"register",method:"email",success:!0,email:i.email,password_strength:d==null?void 0:d.label,invite_code:i.invite_code})},s=>{l({success:!1}),n(I.isEmpty(s.errors)?{submit:s.message}:s.errors),A.event("register",{category:"auth",label:"register",method:"email",success:!1,error:s.message,email:i.email,values:i})})}catch(s){console.error(s),M.current&&(l({success:!1}),n(I.isEmpty(s.errors)?{submit:s.message}:s.errors))}finally{f(!1)}},children:({errors:i,handleBlur:n,handleChange:l,handleSubmit:f,isSubmitting:s,touched:c,values:h,setValues:H})=>e(R,{component:"form",onSubmit:f,children:o(a,{container:!0,spacing:3,children:[e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(w,{htmlFor:"email",children:e(m,{children:"register.email"})}),e(y,{fullWidth:!0,error:Boolean(c.email&&i.email),id:"email",type:"email",value:h.email,name:"email",onBlur:n,onChange:l,placeholder:"user@example.com",inputProps:{},endAdornment:(r==null?void 0:r.is_email_verify)===1?e(le,{email:h.email}):void 0}),c.email&&i.email&&e(g,{error:!0,id:"helper-text-email-signup",children:i.email})]})}),(r==null?void 0:r.is_email_verify)===1&&e(P,{children:e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(w,{htmlFor:"email-code-signup",children:e(m,{children:"register.email_code"})}),e(de,{value:h.email_code,onChange:p=>{H(K=>({...K,email_code:p}))},numInputs:6,containerStyle:{justifyContent:"space-between"},inputStyle:{width:"100%",margin:"8px",padding:"10px",border:`1px solid ${u.palette.mode==="dark"?u.palette.grey[200]:u.palette.grey[300]}`,borderRadius:4,":hover":{borderColor:u.palette.primary.main}},focusStyle:{outline:"none",boxShadow:u.customShadows.primary,border:`1px solid ${u.palette.primary.main}`}}),c.email_code&&i.email_code&&e(g,{error:!0,id:"helper-text-email-signup",children:i.email_code})]})})}),o(a,{item:!0,xs:12,children:[o(_,{spacing:1,children:[e(w,{htmlFor:"password-signup",children:e(m,{children:"register.password"})}),e(y,{fullWidth:!0,error:Boolean(c.password&&i.password),id:"password-signup",type:x?"text":"password",value:h.password,name:"password",onBlur:n,onChange:p=>{l(p),q(p.target.value)},autoComplete:"new-password",endAdornment:e(X,{position:"end",children:e(he,{"aria-label":"toggle password visibility",onClick:D,onMouseDown:G,edge:"end",color:"secondary",children:x?e(Y,{}):e(Z,{})})}),placeholder:"******",inputProps:{}}),c.password&&i.password&&e(g,{error:!0,id:"helper-text-password-signup",children:i.password})]}),e(C,{fullWidth:!0,sx:{mt:2},children:o(a,{container:!0,spacing:2,alignItems:"center",children:[e(a,{item:!0,children:e(R,{sx:{bgcolor:d==null?void 0:d.color,width:85,height:8,borderRadius:"7px"}})}),e(a,{item:!0,children:e(S,{variant:"subtitle1",fontSize:"0.75rem",children:t("register.password_strength",{context:I.lowerCase(d==null?void 0:d.label)}).toString()})})]})})]}),e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(w,{htmlFor:"password-confirm",children:e(m,{children:"register.password_confirm"})}),e(y,{fullWidth:!0,error:Boolean(c.password_confirm&&i.password_confirm),id:"password-confirm",type:x?"text":"password",value:h.password_confirm,name:"password_confirm",onBlur:n,onChange:p=>{l(p),q(p.target.value)},autoComplete:"new-password",placeholder:"******",inputProps:{}}),c.password_confirm&&i.password_confirm&&e(g,{error:!0,id:"helper-text-password-confirm",children:i.password_confirm})]})}),e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(w,{htmlFor:"invite-code-signup",required:(r==null?void 0:r.is_invite_force)===1,children:e(m,{children:"register.invite_code"})}),e(y,{fullWidth:!0,error:Boolean(c.invite_code&&i.invite_code),id:"invite-code-signup",type:"text",value:h.invite_code,name:"invite_code",onBlur:n,onChange:l,required:(r==null?void 0:r.is_invite_force)===1,placeholder:t("register.invite_code_placeholder",{context:(r==null?void 0:r.is_invite_force)===1?"required":"optional"}).toString(),inputProps:{},disabled:k.get("code")!==null}),c.invite_code&&i.invite_code&&e(g,{error:!0,id:"helper-text-email-signup",children:i.invite_code})]})}),e(a,{item:!0,xs:12,children:e(ee,{value:!1,control:e(re,{}),name:"agree",id:"agree",onBlur:n,onChange:l,"aria-required":!0,sx:{alignItems:"flex-start"},label:e(S,{variant:"body2",children:o(m,{i18nKey:"register.license_agree",children:[e(T,{id:"terms-of-service",variant:"subtitle2",component:F,to:"/terms-of-service"}),e(T,{id:"privacy-policy",variant:"subtitle2",component:F,to:"/privacy-policy"})]})})})}),i.submit&&e(a,{item:!0,xs:12,children:e(g,{error:!0,children:i.submit})}),e(a,{item:!0,xs:12,children:e(_e,{children:e(ie,{disableElevation:!0,disabled:s,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"primary",children:s?e(te,{size:24,color:"inherit"}):e(m,{children:"register.submit"})})})})]})})})})},ke=()=>(ge("register"),e(ae,{children:o(a,{container:!0,spacing:3,children:[e(a,{item:!0,xs:12,children:o(_,{direction:"row",justifyContent:"space-between",alignItems:"baseline",sx:{mb:{xs:-.5,sm:.5}},children:[e(S,{variant:"h3",children:e(m,{children:"register.title"})}),e(S,{component:F,to:"/login",variant:"body1",sx:{textDecoration:"none"},color:"primary",children:e(m,{children:"register.go-login"})})]})}),e(a,{item:!0,xs:12,children:e(be,{})})]})}));export{ke as default};
