import{i as H,bc as K,ab as N,k as V,aa as J,r as v,be as X,bf as w,bp as Y,bq as P,j as e,F as A,bd as Z,a$ as R,l as I,B as j,o,aL as a,aj as _,bg as b,ap as m,bh as y,bi as g,br as C,bj as ee,bk as re,bl as ie,bs as te,T as S,bt as ae,bu as se,aI as T,m as k,bm as ne,aq as oe}from"./vendor-4c8effbd.js";import{A as le}from"./AuthWrapper-6020a3ed.js";import{d as de,e as ce,I as me,b as pe}from"./index-efdad191.js";import{A as ue}from"./AnimateButton-f68c7436.js";import{S as he,s as ge,a as _e}from"./password-strength-84ee2c80.js";import{u as we}from"./useQuery-4151a8eb.js";const be=()=>{var F;const u=H(),W=K(),$=N(),{t}=V("common"),{enqueueSnackbar:L}=J(),B=we(),[M]=de(),{data:r}=ce(),[d,E]=v.useState(),[x,O]=v.useState(!1),D=()=>{O(!x)},G=i=>{i.preventDefault()},q=i=>{const n=ge(i);E(_e(n))};v.useEffect(()=>{q("")},[]);const z=v.useMemo(()=>X().shape({email:w().email(t("register.email_invalid").toString()).max(255,t("register.email_max",{count:255}).toString()).required(t("register.email_required").toString()),password:w().min(8,t("register.password_min",{count:8}).toString()).max(255,t("register.password_max",{count:255}).toString()).required(t("register.password_required").toString()),password_confirm:w().oneOf([Y("password"),null],t("register.password_confirm_invalid").toString()).required(t("register.password_confirm_required").toString()),invite_code:r!=null&&r.is_invite_force?w().max(8,t("register.invite_code_max").toString()).required(t("register.invite_code_required").toString()):w().max(8,t("register.invite_code_max").toString()),email_code:r!=null&&r.is_email_verify?P().max(6,t("register.email_code_max").toString()).required(t("register.email_code_required").toString()):P().negative()}),[t,r==null?void 0:r.is_invite_force,r==null?void 0:r.is_email_verify]);return e(A,{children:e(Z,{initialValues:{email:"",password:"",password_confirm:"",invite_code:(F=B.get("code"))!=null?F:"",email_code:"",agree:!1,submit:null},validationSchema:z,onSubmit:async(i,{setErrors:n,setStatus:l,setSubmitting:f})=>{if(!i.agree){l({success:!1}),n({submit:t("register.agree_required").toString()}),f(!1);return}try{await M({email:i.email,password:i.password,invite_code:i.invite_code,email_code:r!=null&&r.is_email_verify?i.email_code:""}).unwrap().then(()=>{l({success:!0}),L(t("notice::register_success"),{variant:"success"}),$("/dashboard",{replace:!0}),R.event("register",{category:"auth",label:"register",method:"email",success:!0,email:i.email,password_strength:d==null?void 0:d.label,invite_code:i.invite_code})},s=>{l({success:!1}),n(I.isEmpty(s.errors)?{submit:s.message}:s.errors),R.event("register",{category:"auth",label:"register",method:"email",success:!1,error:s.message,email:i.email,values:i})})}catch(s){console.error(s),W.current&&(l({success:!1}),n(I.isEmpty(s.errors)?{submit:s.message}:s.errors))}finally{f(!1)}},children:({errors:i,handleBlur:n,handleChange:l,handleSubmit:f,isSubmitting:s,touched:c,values:h,setValues:Q})=>e(j,{component:"form",onSubmit:f,children:o(a,{container:!0,spacing:3,children:[e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(b,{htmlFor:"email",children:e(m,{children:"register.email"})}),e(y,{fullWidth:!0,error:Boolean(c.email&&i.email),id:"email",type:"email",value:h.email,name:"email",onBlur:n,onChange:l,placeholder:"user@example.com",inputProps:{},endAdornment:(r==null?void 0:r.is_email_verify)===1?e(he,{email:h.email}):void 0}),c.email&&i.email&&e(g,{error:!0,id:"helper-text-email-signup",children:i.email})]})}),(r==null?void 0:r.is_email_verify)===1&&e(A,{children:e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(b,{htmlFor:"email-code-signup",children:e(m,{children:"register.email_code"})}),e(C,{value:h.email_code,onChange:p=>{Q(U=>({...U,email_code:p}))},numInputs:6,containerStyle:{justifyContent:"space-between"},inputStyle:{width:"100%",margin:"8px",padding:"10px",border:`1px solid ${u.palette.mode==="dark"?u.palette.grey[200]:u.palette.grey[300]}`,borderRadius:4,":hover":{borderColor:u.palette.primary.main}},focusStyle:{outline:"none",boxShadow:u.customShadows.primary,border:`1px solid ${u.palette.primary.main}`}}),c.email_code&&i.email_code&&e(g,{error:!0,id:"helper-text-email-signup",children:i.email_code})]})})}),o(a,{item:!0,xs:12,children:[o(_,{spacing:1,children:[e(b,{htmlFor:"password-signup",children:e(m,{children:"register.password"})}),e(y,{fullWidth:!0,error:Boolean(c.password&&i.password),id:"password-signup",type:x?"text":"password",value:h.password,name:"password",onBlur:n,onChange:p=>{l(p),q(p.target.value)},autoComplete:"new-password",endAdornment:e(ee,{position:"end",children:e(me,{"aria-label":"toggle password visibility",onClick:D,onMouseDown:G,edge:"end",color:"secondary",children:x?e(re,{}):e(ie,{})})}),placeholder:"******",inputProps:{}}),c.password&&i.password&&e(g,{error:!0,id:"helper-text-password-signup",children:i.password})]}),e(te,{fullWidth:!0,sx:{mt:2},children:o(a,{container:!0,spacing:2,alignItems:"center",children:[e(a,{item:!0,children:e(j,{sx:{bgcolor:d==null?void 0:d.color,width:85,height:8,borderRadius:"7px"}})}),e(a,{item:!0,children:e(S,{variant:"subtitle1",fontSize:"0.75rem",children:t("register.password_strength",{context:I.lowerCase(d==null?void 0:d.label)}).toString()})})]})})]}),e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(b,{htmlFor:"password-confirm",children:e(m,{children:"register.password_confirm"})}),e(y,{fullWidth:!0,error:Boolean(c.password_confirm&&i.password_confirm),id:"password-confirm",type:x?"text":"password",value:h.password_confirm,name:"password_confirm",onBlur:n,onChange:p=>{l(p),q(p.target.value)},autoComplete:"new-password",placeholder:"******",inputProps:{}}),c.password_confirm&&i.password_confirm&&e(g,{error:!0,id:"helper-text-password-confirm",children:i.password_confirm})]})}),e(a,{item:!0,xs:12,children:o(_,{spacing:1,children:[e(b,{htmlFor:"invite-code-signup",required:(r==null?void 0:r.is_invite_force)===1,children:e(m,{children:"register.invite_code"})}),e(y,{fullWidth:!0,error:Boolean(c.invite_code&&i.invite_code),id:"invite-code-signup",type:"text",value:h.invite_code,name:"invite_code",onBlur:n,onChange:l,required:(r==null?void 0:r.is_invite_force)===1,placeholder:t("register.invite_code_placeholder",{context:(r==null?void 0:r.is_invite_force)===1?"required":"optional"}).toString(),inputProps:{},disabled:B.get("code")!==null}),c.invite_code&&i.invite_code&&e(g,{error:!0,id:"helper-text-email-signup",children:i.invite_code})]})}),e(a,{item:!0,xs:12,children:e(ae,{value:!1,control:e(se,{}),name:"agree",id:"agree",onBlur:n,onChange:l,"aria-required":!0,sx:{alignItems:"flex-start"},label:e(S,{variant:"body2",children:o(m,{i18nKey:"register.license_agree",children:[e(T,{id:"terms-of-service",variant:"subtitle2",component:k,to:"/terms-of-service"}),e(T,{id:"privacy-policy",variant:"subtitle2",component:k,to:"/privacy-policy"})]})})})}),i.submit&&e(a,{item:!0,xs:12,children:e(g,{error:!0,children:i.submit})}),e(a,{item:!0,xs:12,children:e(ue,{children:e(ne,{disableElevation:!0,disabled:s,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"primary",children:s?e(oe,{size:24,color:"inherit"}):e(m,{children:"register.submit"})})})})]})})})})},Ie=()=>(pe("register"),e(le,{children:o(a,{container:!0,spacing:3,children:[e(a,{item:!0,xs:12,children:o(_,{direction:"row",justifyContent:"space-between",alignItems:"baseline",sx:{mb:{xs:-.5,sm:.5}},children:[e(S,{variant:"h3",children:e(m,{children:"register.title"})}),e(S,{component:k,to:"/login",variant:"body1",sx:{textDecoration:"none"},color:"primary",children:e(m,{children:"register.go-login"})})]})}),e(a,{item:!0,xs:12,children:e(be,{})})]})}));export{Ie as default};
