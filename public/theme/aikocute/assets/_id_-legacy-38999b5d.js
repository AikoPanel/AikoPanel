System.register(["./vendor-legacy-a194f484.js","./index-legacy-3a6f8cc6.js","./constate.es-legacy-9f590a70.js","./order-legacy-457a0b92.js","./plan-legacy-fc8ce824.js"],(function(e,r){"use strict";var t,c,a,n,o,d,i,l,s,u,h,m,p,g,b,y,f,v,N,k,D,E,x,S,_,M,I,L,w,Y,C,A,P,V,T,H,G,j,R,O,F,z,U,W,q,B;return{setters:[e=>{t=e.k,c=e.a9,a=e.r,n=e.as,o=e.j,d=e.aK,i=e.o,l=e.bJ,s=e.cJ,u=e.cK,h=e.cL,m=e.ai,p=e.T,g=e.ak,b=e.cM,y=e.F,f=e.aw,v=e.aj,N=e.cf,k=e.bz,D=e.bA,E=e.a7,x=e.bB,S=e.cN,_=e.cO,M=e.bi,I=e.a_,L=e.cP,w=e.z,Y=e.af,C=e.p,A=e.s,P=e.at,V=e.bW},e=>{T=e.w,H=e.x,G=e.y,j=e.M,R=e.m,O=e.v,F=e.A,z=e.z,U=e.b},e=>{W=e.c},e=>{q=e.O},e=>{B=e.a}],execute:function(){const[r,J]=W((({tradeNo:e})=>{const{t:r}=t(),{enqueueSnackbar:n}=c(),[o,d]=a.useState(q.PENDING),[i,l]=a.useState(!1),s=T(e),u=H(e,{skip:o!==q.PENDING&&o!==q.PAID||!s.isSuccess,pollingInterval:1e3}),h=G(void 0,{skip:o!==q.PENDING||!s.isSuccess}),[m,p]=a.useState(0),g=a.useMemo((()=>new Map(h.data?.map((e=>[e.id,e])))),[h.data]);return a.useEffect((()=>{0===m&&h.isSuccess&&h.data.length>0&&p(h.data[0].id)}),[h.isSuccess,m,h.data]),a.useEffect((()=>{s.data?.status&&d(s.data.status)}),[s.data?.status]),a.useEffect((()=>{u.data&&d(u.data)}),[u.data]),a.useEffect((()=>{s.error&&n(r("notice::order-detail-error",{error:s.error.message}),{variant:"error"})}),[s.error]),{tradeNo:e,status:o,detail:s,callback:u,paymentMethod:h,paymentMethodIndex:g,paymentMethodState:m,setPaymentMethodState:p,isSubmitting:i,setSubmitting:l}})),K=()=>{const{t:e}=t(),{detail:{data:r,isLoading:c}}=J(),s=a.useMemo((()=>{const e=n.unix(r?.created_at||0);switch(r?.period){case B.ONEDAY:return e.add(1,"day");case B.MONTHLY:return e.add(1,"month");case B.BIMONTHLY:return e.add(2,"month");case B.QUARTERLY:return e.add(3,"month");case B.HALF_YEARLY:return e.add(6,"month");case B.YEARLY:return e.add(1,"year");case B.TWO_YEARLY:return e.add(2,"year");case B.THREE_YEARLY:return e.add(3,"year");default:return e}}),[r?.created_at,r?.period]),u=a.useMemo((()=>[{label:e("order.checkout.product-info-card.product-name"),value:r?.plan.name},{label:e("order.checkout.product-info-card.product-type"),value:e("order.checkout.product-info-card.product-period",{context:r?.period})},{label:e("order.checkout.product-info-card.traffic"),value:e("order.checkout.product-info-card.traffic",{count:r?.plan.transfer_enable||0,context:null===r?.plan.transfer_enable?"unlimited":"limited"})},...r?.period===B.ONETIME?[]:[{label:e("order.checkout.product-info-card.next-billing-date"),value:s.format("DD/MM/YYYY")}]]),[r,e,s]);return o(j,{title:e("order.checkout.product-info-card.title"),children:o(d,{container:!0,spacing:1,children:u.map(((e,r)=>o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:4,children:e.label}),o(d,{item:!0,xs:8,children:c?o(l,{variant:"text",width:"100%"}):e.value})]})},r)))})})},Q=R()(((e,{status:r})=>({root:{padding:e.spacing(1)},icon:{fontSize:e.spacing(8),color:e.palette[r===q.FINISHED?"success":"warning"].main}}))),X=()=>{const{t:e}=t(),{status:r}=J(),{classes:c}=Q({status:r}),n=a.useMemo((()=>{switch(r){case q.FINISHED:return o(s,{className:c.icon});case q.CANCELLED:return o(h,{className:c.icon});case q.PENDING:return o(u,{className:c.icon});case q.DEDUCTED:return o(s,{className:c.icon});default:return null}}),[r]),d=a.useMemo((()=>{switch(r){case q.FINISHED:return"finished";case q.CANCELLED:return"cancelled";case q.PAID:return"paid";case q.DEDUCTED:return"deducted";default:return null}}),[r]);return o(j,{className:c.root,children:i(m,{direction:"column",spacing:3,children:[n,i(m,{direction:"column",spacing:1,alignItems:"center",children:[o(p,{variant:"h3",children:e("order.checkout.status-card.status",{context:d})}),o(p,{variant:"body1",color:"textSecondary",align:"center",children:e("order.checkout.status-card.description",{context:d})})]})]})})},Z=()=>{const{t:e}=t(),[r,{setLeft:a,setRight:n}]=g(!1),{tradeNo:d}=J(),[l]=O(),{enqueueSnackbar:s}=c(),u=b((async()=>{try{const r=await l(d).unwrap();r?(s(e("notice::order-cancel_success"),{variant:"success"}),I.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!0})):(s(e("notice::order-cancel_failed"),{variant:"error"}),I.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!1,error:r}))}catch(r){console.error("error when cancel order:",r),s(e("notice::order-cancel_failed"),{variant:"error"}),I.event("order_cancel",{category:"order",label:"cancel",tradeNo:d,success:!1,error:r})}a()}));return i(y,{children:[o(f,{title:e("order.checkout.order-info-card.cancel-tooltip"),placement:"top",children:o(v,{onClick:n,children:o(N,{})})}),i(k,{open:r,onClose:a,children:[o(D,{children:o(m,{direction:"row",alignItems:"center",spacing:1.5,children:o(p,{variant:"inherit",children:e("order.checkout.order-info-card.cancel-dialog.title")})})}),o(E,{}),o(x,{children:o(S,{children:e("order.checkout.order-info-card.cancel-dialog.content")})}),i(_,{children:[o(M,{onClick:a,children:e("order.checkout.order-info-card.cancel-dialog.cancel-button")}),o(M,{variant:"contained",color:"primary",onClick:u,children:e("order.checkout.order-info-card.cancel-dialog.confirm-button")})]})]})]})},$=()=>{const{t:e}=t(),{detail:{data:r,isLoading:c},status:s}=J(),u=a.useMemo((()=>{switch(s){case q.FINISHED:return"paid";case q.CANCELLED:return"cancelled";case q.PENDING:return"pending";case q.DEDUCTED:return"deducted";default:return null}}),[s]),h=a.useMemo((()=>[{label:e("order.checkout.order-info-card.order-number"),value:r?.trade_no},{label:e("order.checkout.order-info-card.order-date"),value:n.unix(r?.created_at||0).format("DD-MM-YYYY HH:mm:ss")},{label:e("order.checkout.order-info-card.order-status"),value:e("order.checkout.order-info-card.order-status-value",{context:u})},...r?.discount_amount?[{label:e("order.checkout.order-info-card.coupon-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.discount_amount||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],...r?.surplus_amount?[{label:e("order.checkout.order-info-card.subscription-deduct-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.surplus_amount||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],{label:e("order.checkout.order-info-card.order-amount"),value:e("order.checkout.order-info-card.price",{value:(Number(r?.total_amount||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]),[r,e]);return o(j,{title:e("order.checkout.order-info-card.title"),secondary:s===q.PENDING&&o(Z,{}),children:o(d,{container:!0,spacing:2,children:h.map(((e,r)=>o(d,{item:!0,xs:12,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:4,children:e.label}),o(d,{item:!0,xs:8,children:o(p,{variant:"body1",noWrap:!0,children:c?o(l,{variant:"text",width:"100%"}):e.value})})]})},r)))})})},ee=R()((e=>({icon:{fontSize:e.spacing(2.5)}}))),re=()=>{const{t:e}=t(),{paymentMethod:{isLoading:r},detail:{isLoading:c},paymentMethodIndex:n,paymentMethodState:d,setPaymentMethodState:s,isSubmitting:u}=J(),h=a.useMemo((()=>Array.from(n.values())),[n]),{classes:m}=ee(),p=a.useCallback((({icon:e})=>!0===e.includes("alipay")?o(F,{type:"combined",children:o(L,{className:m.icon})}):o(F,{type:"combined",color:"secondary",src:e})),[]),g=e=>r=>{r.preventDefault(),s(e.id),I.event("select",{category:"order",label:"payment_method",method:n.get(e.id)?.name,method_id:e.id})};return o(j,{title:e("order.checkout.payment-method-card.title"),content:!1,children:o(w,{sx:{p:0},children:r||c?Array.from(new Array(3)).map(((e,r)=>o(Y,{disablePadding:!0,divider:!0,children:o(C,{disabled:!0,children:o(A,{children:o(l,{variant:"text",width:100})})})},r))):h.length>0?h.map((e=>o(Y,{disablePadding:!0,divider:!0,children:i(C,{selected:d===e.id,disabled:u,onClick:g(e),onTouchEnd:g(e),children:[e.icon&&o(P,{children:o(p,{icon:e.icon})}),o(A,{children:e.name})]})},e.id))):o(y,{children:o(A,{sx:{m:1.8},children:e("notice::no-payment-method")})})})})},te=()=>{const{t:e}=t(),{detail:{data:r,isLoading:n},paymentMethodState:d,paymentMethodIndex:s,setSubmitting:u,isSubmitting:h,paymentMethod:g}=J(),[b]=z(),{enqueueSnackbar:y}=c(),f=a.useMemo((()=>[{label:r?.plan.name,value:e("order.checkout.billing-card.price",{value:Number((r?.plan[r?.period]??0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})},...r?.discount_amount||r?.surplus_amount?[{label:e("order.checkout.billing-card.deduction"),value:e("order.checkout.billing-card.price",{value:(((r?.discount_amount??0)+(r?.surplus_amount??0))/-100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],{label:e("order.checkout.billing-card.total-price"),value:e("order.checkout.billing-card.price",{value:Number((r?.total_amount??0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]),[r,e]),v=a.useCallback((async t=>{if(t.preventDefault(),r&&d)try{u(!0),I.event("click",{category:"order",label:"checkout",method:s.get(d)?.name,method_id:d}),window.location.href=await b({trade_no:r.trade_no,method:d}).unwrap()}catch(c){console.error(c),y(e("notice::checkout-failed"),{variant:"error"}),I.event("click",{category:"order",label:"checkout",method:s.get(d)?.name,method_id:d,success:!1,error:c})}finally{u(!1)}else y(e("notice::data-not-loaded"),{variant:"error"})}),[b,r,d]);return o(j,{title:e("order.checkout.billing-card.title"),children:i(m,{spacing:2,divider:o(E,{}),children:[f.map(((e,r)=>n?o(l,{variant:"text",width:"100%",height:40},r):i(m,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[o(p,{variant:"body1",children:e.label}),o(p,{variant:"body1",children:e.value})]},r))),o(M,{fullWidth:!0,variant:"contained",disabled:n||h||0==g.data?.length,onClick:v,children:e("order.checkout.billing-card.button")})]})})},ce=()=>{const{status:e}=J();return i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:!0,children:i(d,{container:!0,spacing:2,children:[e!==q.PENDING&&o(d,{item:!0,xs:12,children:o(X,{})}),o(d,{item:!0,xs:12,children:o(K,{})}),o(d,{item:!0,xs:12,children:o($,{})}),e===q.PENDING&&o(d,{item:!0,xs:12})]})}),e===q.PENDING&&o(d,{item:!0,xs:12,md:4,children:i(d,{container:!0,spacing:2,children:[o(d,{item:!0,xs:12,children:o(re,{})}),o(d,{item:!0,xs:12,children:o(te,{})})]})})]})};e("default",(()=>{U("checkout");const e=V().id;return o(r,{tradeNo:e||"",children:o(ce,{})})}))}}}));
