import{i as W,k as j,bb as E,aa as D,a9 as K,r as S,j as e,F as M,a_ as v,o as t,aK as s,ai as g,bc as _,ao as c,bd as C,be as h,bf as $,bg as z,bh as L,bs as G,B as V,T as P,l as H,bi as N,ap as U,m as J}from"./vendor-894d6afa.js";import{A as Q}from"./AuthWrapper-a2b9dc7c.js";import{F as X,c as Y,a as b,b as Z}from"./formik.esm-4935cab4.js";import{S as ee,O as re,s as oe,a as se}from"./password-strength-dc897e1e.js";import{A as ae}from"./AnimateButton-c09ecc76.js";import{g as te,I as ie,b as ne}from"./index-33033ac6.js";import"./hey-listen.es-3d38fef0.js";const de=()=>{const p=W(),{t:o}=j("common"),x=E(),F=D(),{enqueueSnackbar:k}=K(),[B]=te(),[m,I]=S.useState(),[f,q]=S.useState(!1),A=()=>{q(!f)},T=r=>{r.preventDefault()},y=r=>{const a=oe(r);I(se(a))};return S.useEffect(()=>{y("")},[]),e(M,{children:e(X,{initialValues:{email:"",password:"",password_confirm:"",email_code:"",submit:null},validationSchema:Y().shape({email:b().email(o("forgot_password.email_invalid").toString()).max(255,o("forgot_password.email_max",{count:255}).toString()).required(o("forgot_password.email_required").toString()),password:b().max(255,o("forgot_password.password_max",{count:255}).toString()).required(o("forgot_password.password_required").toString()),password_confirm:b().oneOf([Z("password"),null],o("forgot_password.password_confirm_invalid").toString()).required(o("forgot_password.password_confirm_required").toString()),email_code:b().min(6,o("forgot_password.email_code_min",{count:6}).toString()).max(6,o("forgot_password.email_code_max",{count:6}).toString()).required(o("forgot_password.email_code_required").toString())}),onSubmit:async(r,{setErrors:a,setStatus:i,setSubmitting:u})=>{if(r.email_code.length!==6){i({success:!1}),a({email_code:o("forgot_password.email_code_invalid").toString()});return}await B({email:r.email,password:r.password,email_code:r.email_code}).unwrap().then(()=>{x.current&&(i({success:!0}),u(!1),k(o("notice::forgot_password.reset_success"),{variant:"success"}),v.event("reset_password",{category:"auth",label:"reset_password",email:r.email,success:!0}),F("/login",{replace:!0}))}).catch(n=>{console.error("Error in reset password",n),x.current&&(i({success:!1}),a(n.errors||{submit:n.message}),u(!1),v.event("reset_password",{category:"auth",label:"reset_password",email:r.email,success:!1,error:n.message}))}).finally(()=>{x.current&&u(!1)})},children:({errors:r,handleBlur:a,handleChange:i,handleSubmit:u,isSubmitting:n,touched:d,values:w,setValues:O})=>e("form",{noValidate:!0,onSubmit:u,children:t(s,{container:!0,spacing:3,children:[e(s,{item:!0,xs:12,children:t(g,{spacing:1,children:[e(_,{htmlFor:"email",children:e(c,{children:"forgot_password.email"})}),e(C,{fullWidth:!0,error:Boolean(d.email&&r.email),id:"email",type:"email",value:w.email,name:"email",onBlur:a,onChange:i,placeholder:"user@example.com",inputProps:{},endAdornment:e(ee,{email:w.email})}),d.email&&r.email&&e(h,{error:!0,id:"helper-text-email-signup",children:r.email})]})}),e(s,{item:!0,xs:12,children:t(g,{spacing:1,children:[e(_,{htmlFor:"email-code-signup",children:e(c,{children:"forgot_password.email_code"})}),e(re,{value:w.email_code,onChange:l=>{O(R=>({...R,email_code:l}))},numInputs:6,containerStyle:{justifyContent:"space-between"},inputProps:{name:"email_code",id:"email-code-signup",onBlur:a},inputStyle:{width:"100%",margin:"8px",padding:"10px",border:`1px solid ${p.palette.mode==="dark"?p.palette.grey[200]:p.palette.grey[300]}`,borderRadius:4,":hover":{borderColor:p.palette.primary.main}},focusStyle:{outline:"none",boxShadow:p.customShadows.primary,border:`1px solid ${p.palette.primary.main}`}}),d.email_code&&r.email_code&&e(h,{error:!0,id:"helper-text-email-signup",children:r.email_code})]})}),t(s,{item:!0,xs:12,children:[t(g,{spacing:1,children:[e(_,{htmlFor:"password-signup",children:e(c,{children:"forgot_password.password"})}),e(C,{fullWidth:!0,error:Boolean(d.password&&r.password),id:"password-signup",type:f?"text":"password",value:w.password,name:"password",onBlur:a,onChange:l=>{i(l),y(l.target.value)},autoComplete:"new-password",endAdornment:e($,{position:"end",children:e(ie,{"aria-label":"toggle password visibility",onClick:A,onMouseDown:T,edge:"end",color:"secondary",children:f?e(z,{}):e(L,{})})}),placeholder:"******",inputProps:{}}),d.password&&r.password&&e(h,{error:!0,id:"helper-text-password-signup",children:r.password})]}),e(G,{fullWidth:!0,sx:{mt:2},children:t(s,{container:!0,spacing:2,alignItems:"center",children:[e(s,{item:!0,children:e(V,{sx:{bgcolor:m==null?void 0:m.color,width:85,height:8,borderRadius:"7px"}})}),e(s,{item:!0,children:e(P,{variant:"subtitle1",fontSize:"0.75rem",children:o("forgot_password.password_strength",{context:H.lowerCase(m==null?void 0:m.label)}).toString()})})]})})]}),e(s,{item:!0,xs:12,children:t(g,{spacing:1,children:[e(_,{htmlFor:"password-confirm",children:e(c,{children:"forgot_password.password_confirm"})}),e(C,{fullWidth:!0,error:Boolean(d.password_confirm&&r.password_confirm),id:"password-confirm",type:f?"text":"password",value:w.password_confirm,name:"password_confirm",onBlur:a,onChange:l=>{i(l),y(l.target.value)},autoComplete:"new-password",placeholder:"******",inputProps:{}}),d.password_confirm&&r.password_confirm&&e(h,{error:!0,id:"helper-text-password-confirm",children:r.password_confirm})]})}),r.submit&&e(s,{item:!0,xs:12,children:e(h,{error:!0,children:r.submit})}),e(s,{item:!0,xs:12,children:e(ae,{children:e(N,{disableElevation:!0,disabled:n,fullWidth:!0,size:"large",type:"submit",variant:"contained",color:"primary",children:n?e(U,{size:24}):e(c,{i18nKey:"forgot_password.submit",children:"重置密码"})})})})]})})})})},ge=()=>(ne("forgot-password"),e(Q,{children:t(s,{container:!0,spacing:3,children:[e(s,{item:!0,xs:12,children:t(g,{direction:"row",justifyContent:"space-between",alignItems:"baseline",sx:{mb:{xs:-.5,sm:.5}},children:[e(P,{variant:"h3",children:e(c,{i18nKey:"forgot_password.title",children:"Forgot password"})}),e(P,{component:J,to:"/login",variant:"body1",sx:{textDecoration:"none"},color:"primary",children:e(c,{i18nKey:"forgot_password.back_to_login",children:"Back to login"})})]})}),e(s,{item:!0,xs:12,children:e(de,{})})]})}));export{ge as default};
