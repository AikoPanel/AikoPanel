import{k as g,j as n,bK as T,i as I,a4 as k,bb as A,r as u,at as m,cp as d,l as j,cq as N,o as D,aL as p}from"./vendor-4c8effbd.js";import{D as G}from"./DataGrid-345901e9.js";import{$ as v,M as b,b as Y}from"./index-efdad191.js";import{K as F}from"./KeyValueTable-d7be3165.js";const C=()=>{const{t:r}=g();return n(T,{severity:"info",children:r("traffic.alert")})},L=()=>{const{t:r}=g(),t=I(),f=k(t.breakpoints.down("md")),{data:o,isLoading:h}=v(),[l,c]=A.useState(10),s=u.useMemo(()=>[{field:"record_at",headerName:r("traffic.table.record_at",{context:"header"}).toString(),description:r("traffic.table.record_at",{context:"description"}).toString(),width:200,type:"dateTime",valueGetter:e=>m.unix(e.value).toDate(),valueFormatter:e=>m(e.value).format("DD-MM-YYYY HH:mm")},{field:"u",headerName:r("traffic.table.upload",{context:"header"}).toString(),description:r("traffic.table.upload",{context:"description"}).toString(),width:120,type:"number",valueGetter:e=>e.value/(isNaN(parseInt(e.row.server_rate))?1:parseInt(e.row.server_rate)),valueFormatter:e=>d(e.value,{base:2,standard:"jedec",round:2,roundingMethod:"floor"})},{field:"d",headerName:r("traffic.table.download",{context:"header"}).toString(),description:r("traffic.table.download",{context:"description"}).toString(),width:120,type:"number",valueGetter:e=>e.value/(isNaN(parseInt(e.row.server_rate))?1:parseInt(e.row.server_rate)),valueFormatter:e=>d(e.value,{base:2,standard:"jedec",round:2,roundingMethod:"floor"})},{field:"server_rate",headerName:r("traffic.table.server_rate",{context:"header"}).toString(),description:r("traffic.table.server_rate",{context:"description"}).toString(),width:120,type:"number",valueGetter:e=>parseInt(e.value)||1,valueFormatter:e=>`${e.value.toFixed(2)} x`},{field:"total",headerName:r("traffic.table.total",{context:"header"}).toString(),description:r("traffic.table.total",{context:"description"}).toString(),width:160,type:"number",valueGetter:e=>e.row.u+e.row.d,valueFormatter:e=>d(e.value,{base:2,standard:"jedec",round:2,roundingMethod:"floor"})}],[r,m,d]);return n(b,{content:!1,children:n(G,{columns:s,rows:o!=null?o:[],loading:h,getRowId:e=>`${e.record_at}_${e.server_rate}`,rowsPerPageOptions:[5,10,25,50],pageSize:l,onPageSizeChange:e=>c(e),sx:{height:{md:400}},autoHeight:f})})},z=()=>{const{t:r}=g(),t=I(),{secondary:f}=t.palette.text,[o,h]=u.useState(7),{data:l}=v(),c=u.useMemo(()=>j.take(Array.from((l!=null?l:[]).reduce((a,i)=>{var x,y,S,w,_,M;return a.set(i.record_at,{u:i.u/(isNaN(parseInt(i.server_rate))?1:parseInt(i.server_rate))+((y=(x=a.get(i.record_at))==null?void 0:x.u)!=null?y:0),d:i.d/(isNaN(parseInt(i.server_rate))?1:parseInt(i.server_rate))+((w=(S=a.get(i.record_at))==null?void 0:S.d)!=null?w:0),total:(i.u+i.d)/parseInt(i.server_rate)+((M=(_=a.get(i.record_at))==null?void 0:_.total)!=null?M:0)})},new Map).values()).reverse(),o),[l,o]),s=u.useMemo(()=>[{name:r("traffic.chart.upload",{context:"name"}).toString(),data:c.map(a=>a.u)||Array(o).fill(0),color:t.palette.warning.main},{name:r("traffic.chart.download",{context:"name"}).toString(),data:c.map(a=>a.d)||Array(o).fill(0),color:t.palette.success.main},{name:r("traffic.chart.total",{context:"name"}).toString(),data:c.map(a=>a.total)||Array(o).fill(0),color:t.palette.primary.light}],[l,o,t.palette,r]),e=u.useMemo(()=>({chart:{height:280,type:"area",toolbar:{show:!1}},fill:{type:"gradient",gradient:{shadeIntensity:1,type:"vertical",inverseColors:!1,opacityFrom:.5,opacityTo:0}},dataLabels:{enabled:!1},stroke:{curve:"smooth",width:2},grid:{show:!0,strokeDashArray:0,position:"back",borderColor:t.palette.divider,xaxis:{lines:{show:!0}},yaxis:{lines:{show:!0}}},xaxis:{categories:Array.from(new Array(o)).map((a,i)=>m().subtract(i,"day").toISOString()).reverse(),labels:{formatter:a=>m(a).format("MM.DD"),style:{colors:Array.from(new Array(o)).map(()=>f)}},axisBorder:{show:!1,color:t.palette.divider},tickAmount:o,axisTicks:{show:!1}},yaxis:{labels:{formatter:a=>String(d(a,{base:2,standard:"jedec",round:2,roundingMethod:"floor"})),style:{colors:Array.from(new Array(o)).map(()=>f)}},axisBorder:{show:!1},axisTicks:{show:!1}},tooltip:{theme:t.palette.mode,x:{formatter:a=>m().subtract(o-a,"day").format("DD-MM-YYYY")},y:{formatter:a=>String(d(a,{base:2,standard:"jedec",round:2,roundingMethod:"floor"}))}},legend:{show:!1}}),[o,t.palette,r]);return n(b,{title:r("traffic.chart.title").toString(),divider:!1,children:n(N,{options:e,series:s,type:"area",height:280})})},P=()=>{const{t:r}=g(),{data:t,isLoading:f}=v(),o=u.useMemo(()=>{var h,l,c;return[{key:r("traffic.info-card.sum_upload",{context:"label"}).toString(),value:String(d((h=t==null?void 0:t.reduce((s,e)=>s+e.u/(parseInt(e.server_rate)||1),0))!=null?h:0,{base:2,standard:"jedec",round:2,roundingMethod:"floor"}))},{key:r("traffic.info-card.sum_download",{context:"label"}).toString(),value:String(d((l=t==null?void 0:t.reduce((s,e)=>s+e.d/(parseInt(e.server_rate)||1),0))!=null?l:0,{base:2,standard:"jedec",round:2,roundingMethod:"floor"}))},{key:r("traffic.info-card.sum_total",{context:"label"}).toString(),value:String(d((c=t==null?void 0:t.reduce((s,e)=>s+(e.u+e.d)/(parseInt(e.server_rate)||1),0))!=null?c:0,{base:2,standard:"jedec",round:2,roundingMethod:"floor"}))},{key:r("traffic.info-card.day_num",{context:"label"}).toString(),value:new Map(t==null?void 0:t.map(s=>[s.record_at,null])).size.toString()},{key:r("traffic.info-card.average_total",{context:"label"}).toString(),value:String(d((t!=null?t:[]).reduce((s,e)=>s+(e.u+e.d)/(parseInt(e.server_rate)||1),0)/Math.max((t!=null?t:[]).length,1),{base:2,standard:"jedec",round:2,roundingMethod:"floor"}))}]},[r,d,t]);return n(b,{title:r("traffic.info-card.title").toString(),contentSX:{height:{xs:"auto",md:335}},children:n(F,{data:o,isValueLoading:f})})},$=()=>D(p,{container:!0,spacing:2,children:[n(p,{item:!0,xs:12,children:n(C,{})}),n(p,{item:!0,xs:12,md:8,children:n(z,{})}),n(p,{item:!0,xs:12,md:4,children:n(P,{})}),n(p,{item:!0,xs:12,children:n(L,{})})]}),Q=()=>(Y("traffic"),n($,{}));export{Q as default};
