import{bO as R,k as C,aa as P,r as u,at as G,j as r,aL as o,o as f,bC as L,b$ as A,c0 as B,c1 as Q,aj as M,T as E,al as j,c2 as W,F as V,ax as z,ak as U,bW as q,bw as $,bx as J,a8 as F,by as K,c3 as X,c4 as Z,bm as w,a$ as S,c5 as ee,z as re,ag as Y,p as T,s as _,au as te,bN as ce}from"./vendor-4c8effbd.js";import{w as ne,x as oe,y as ae,M as D,m as H,v as ie,A as O,z as se,b as le}from"./index-efdad191.js";import{O as a}from"./order-f9773b97.js";import{a as b}from"./plan-357bf2a6.js";const de=({tradeNo:t})=>{var y;const{t:e}=C(),{enqueueSnackbar:i}=P(),[c,l]=u.useState(a.PENDING),[n,m]=u.useState(!1),d=ne(t),h=oe(t,{skip:c!==a.PENDING&&c!==a.PAID||!d.isSuccess,pollingInterval:1e3}),g=ae(void 0,{skip:c!==a.PENDING||!d.isSuccess}),[k,s]=u.useState(0),v=u.useMemo(()=>{var p;return new Map((p=g.data)==null?void 0:p.map(N=>[N.id,N]))},[g.data]);return u.useEffect(()=>{k===0&&g.isSuccess&&g.data.length>0&&s(g.data[0].id)},[g.isSuccess,k,g.data]),u.useEffect(()=>{var p;(p=d.data)!=null&&p.status&&l(d.data.status)},[(y=d.data)==null?void 0:y.status]),u.useEffect(()=>{h.data&&l(h.data)},[h.data]),u.useEffect(()=>{d.error&&i(e("notice::order-detail-error",{error:d.error.message}),{variant:"error"})},[d.error]),{tradeNo:t,status:c,detail:d,callback:h,paymentMethod:g,paymentMethodIndex:v,paymentMethodState:k,setPaymentMethodState:s,isSubmitting:n,setSubmitting:m}},[ue,x]=R(de),he=()=>{const{t}=C(),{detail:{data:e,isLoading:i}}=x(),c=u.useMemo(()=>{const n=G.unix((e==null?void 0:e.created_at)||0);switch(e==null?void 0:e.period){case b.ONEDAY:return n.add(1,"day");case b.MONTHLY:return n.add(1,"month");case b.BIMONTHLY:return n.add(2,"month");case b.QUARTERLY:return n.add(3,"month");case b.HALF_YEARLY:return n.add(6,"month");case b.YEARLY:return n.add(1,"year");case b.TWO_YEARLY:return n.add(2,"year");case b.THREE_YEARLY:return n.add(3,"year");default:return n}},[e==null?void 0:e.created_at,e==null?void 0:e.period]),l=u.useMemo(()=>[{label:t("order.checkout.product-info-card.product-name"),value:e==null?void 0:e.plan.name},{label:t("order.checkout.product-info-card.product-type"),value:t("order.checkout.product-info-card.product-period",{context:e==null?void 0:e.period})},{label:t("order.checkout.product-info-card.traffic"),value:t("order.checkout.product-info-card.traffic",{count:(e==null?void 0:e.plan.transfer_enable)||0,context:(e==null?void 0:e.plan.transfer_enable)===null?"unlimited":"limited"})},...(e==null?void 0:e.period)===b.ONETIME?[]:[{label:t("order.checkout.product-info-card.next-billing-date"),value:c.format("DD/MM/YYYY")}]],[e,t,c]);return r(D,{title:t("order.checkout.product-info-card.title"),children:r(o,{container:!0,spacing:1,children:l.map((n,m)=>r(o,{item:!0,xs:12,children:f(o,{container:!0,spacing:2,children:[r(o,{item:!0,xs:4,children:n.label}),r(o,{item:!0,xs:8,children:i?r(L,{variant:"text",width:"100%"}):n.value})]})},m))})})},me=H()((t,{status:e})=>({root:{padding:t.spacing(1)},icon:{fontSize:t.spacing(8),color:t.palette[e===a.FINISHED?"success":"warning"].main}})),pe=()=>{const{t}=C(),{status:e}=x(),{classes:i}=me({status:e}),c=u.useMemo(()=>{switch(e){case a.FINISHED:return r(A,{className:i.icon});case a.CANCELLED:return r(Q,{className:i.icon});case a.PENDING:return r(B,{className:i.icon});case a.DEDUCTED:return r(A,{className:i.icon});default:return null}},[e]),l=u.useMemo(()=>{switch(e){case a.FINISHED:return"finished";case a.CANCELLED:return"cancelled";case a.PAID:return"paid";case a.DEDUCTED:return"deducted";default:return null}},[e]);return r(D,{className:i.root,children:f(M,{direction:"column",spacing:3,children:[c,f(M,{direction:"column",spacing:1,alignItems:"center",children:[r(E,{variant:"h3",children:t("order.checkout.status-card.status",{context:l})}),r(E,{variant:"body1",color:"textSecondary",align:"center",children:t("order.checkout.status-card.description",{context:l})})]})]})})},ge=()=>{const{t}=C(),[e,{setLeft:i,setRight:c}]=j(!1),{tradeNo:l}=x(),[n]=ie(),{enqueueSnackbar:m}=P(),d=W(async()=>{try{const h=await n(l).unwrap();h?(m(t("notice::order-cancel_success"),{variant:"success"}),S.event("order_cancel",{category:"order",label:"cancel",tradeNo:l,success:!0})):(m(t("notice::order-cancel_failed"),{variant:"error"}),S.event("order_cancel",{category:"order",label:"cancel",tradeNo:l,success:!1,error:h}))}catch(h){console.error("error when cancel order:",h),m(t("notice::order-cancel_failed"),{variant:"error"}),S.event("order_cancel",{category:"order",label:"cancel",tradeNo:l,success:!1,error:h})}i()});return f(V,{children:[r(z,{title:t("order.checkout.order-info-card.cancel-tooltip"),placement:"top",children:r(U,{onClick:c,children:r(q,{})})}),f($,{open:e,onClose:i,children:[r(J,{children:r(M,{direction:"row",alignItems:"center",spacing:1.5,children:r(E,{variant:"inherit",children:t("order.checkout.order-info-card.cancel-dialog.title")})})}),r(F,{}),r(K,{children:r(X,{children:t("order.checkout.order-info-card.cancel-dialog.content")})}),f(Z,{children:[r(w,{onClick:i,children:t("order.checkout.order-info-card.cancel-dialog.cancel-button")}),r(w,{variant:"contained",color:"primary",onClick:d,children:t("order.checkout.order-info-card.cancel-dialog.confirm-button")})]})]})]})},ye=()=>{const{t}=C(),{detail:{data:e,isLoading:i},status:c}=x(),l=u.useMemo(()=>{switch(c){case a.FINISHED:return"paid";case a.CANCELLED:return"cancelled";case a.PENDING:return"pending";case a.DEDUCTED:return"deducted";default:return null}},[c]),n=u.useMemo(()=>[{label:t("order.checkout.order-info-card.order-number"),value:e==null?void 0:e.trade_no},{label:t("order.checkout.order-info-card.order-date"),value:G.unix((e==null?void 0:e.created_at)||0).format("DD-MM-YYYY HH:mm:ss")},{label:t("order.checkout.order-info-card.order-status"),value:t("order.checkout.order-info-card.order-status-value",{context:l})},...e!=null&&e.discount_amount?[{label:t("order.checkout.order-info-card.coupon-amount"),value:t("order.checkout.order-info-card.price",{value:(Number((e==null?void 0:e.discount_amount)||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],...e!=null&&e.surplus_amount?[{label:t("order.checkout.order-info-card.subscription-deduct-amount"),value:t("order.checkout.order-info-card.price",{value:(Number((e==null?void 0:e.surplus_amount)||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],{label:t("order.checkout.order-info-card.order-amount"),value:t("order.checkout.order-info-card.price",{value:(Number((e==null?void 0:e.total_amount)||0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}],[e,t]);return r(D,{title:t("order.checkout.order-info-card.title"),secondary:c===a.PENDING&&r(ge,{}),children:r(o,{container:!0,spacing:2,children:n.map((m,d)=>r(o,{item:!0,xs:12,children:f(o,{container:!0,spacing:2,children:[r(o,{item:!0,xs:4,children:m.label}),r(o,{item:!0,xs:8,children:r(E,{variant:"body1",noWrap:!0,children:i?r(L,{variant:"text",width:"100%"}):m.value})})]})},d))})})},fe=H()(t=>({icon:{fontSize:t.spacing(2.5)}})),be=()=>{const{t}=C(),{paymentMethod:{isLoading:e},detail:{isLoading:i},paymentMethodIndex:c,paymentMethodState:l,setPaymentMethodState:n,isSubmitting:m}=x(),d=u.useMemo(()=>Array.from(c.values()),[c]),{classes:h}=fe(),g=u.useCallback(({icon:s})=>{switch(!0){case s.includes("alipay"):return r(O,{type:"combined",children:r(ee,{className:h.icon})});default:return r(O,{type:"combined",color:"secondary",src:s})}},[]),k=s=>v=>{var y;v.preventDefault(),n(s.id),S.event("select",{category:"order",label:"payment_method",method:(y=c.get(s.id))==null?void 0:y.name,method_id:s.id})};return r(D,{title:t("order.checkout.payment-method-card.title"),content:!1,children:r(re,{sx:{p:0},children:e||i?Array.from(new Array(3)).map((s,v)=>r(Y,{disablePadding:!0,divider:!0,children:r(T,{disabled:!0,children:r(_,{children:r(L,{variant:"text",width:100})})})},v)):d.length>0?d.map(s=>r(Y,{disablePadding:!0,divider:!0,children:f(T,{selected:l===s.id,disabled:m,onClick:k(s),onTouchEnd:k(s),children:[s.icon&&r(te,{children:r(g,{icon:s.icon})}),r(_,{children:s.name})]})},s.id)):r(V,{children:r(_,{sx:{m:1.8},children:t("notice::no-payment-method")})})})})},ke=()=>{var v;const{t}=C(),{detail:{data:e,isLoading:i},paymentMethodState:c,paymentMethodIndex:l,setSubmitting:n,isSubmitting:m,paymentMethod:d}=x(),[h]=se(),{enqueueSnackbar:g}=P(),k=u.useMemo(()=>{var y,p,N,I;return[{label:e==null?void 0:e.plan.name,value:t("order.checkout.billing-card.price",{value:Number(((y=e==null?void 0:e.plan[e==null?void 0:e.period])!=null?y:0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})},...e!=null&&e.discount_amount||e!=null&&e.surplus_amount?[{label:t("order.checkout.billing-card.deduction"),value:t("order.checkout.billing-card.price",{value:((((p=e==null?void 0:e.discount_amount)!=null?p:0)+((N=e==null?void 0:e.surplus_amount)!=null?N:0))/-100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]:[],{label:t("order.checkout.billing-card.total-price"),value:t("order.checkout.billing-card.price",{value:Number(((I=e==null?void 0:e.total_amount)!=null?I:0)/100).toLocaleString("vi-VN",{style:"currency",currency:"VND"})})}]},[e,t]),s=u.useCallback(async y=>{var p,N;if(y.preventDefault(),e&&c)try{n(!0),S.event("click",{category:"order",label:"checkout",method:(p=l.get(c))==null?void 0:p.name,method_id:c}),window.location.href=await h({trade_no:e.trade_no,method:c}).unwrap()}catch(I){console.error(I),g(t("notice::checkout-failed"),{variant:"error"}),S.event("click",{category:"order",label:"checkout",method:(N=l.get(c))==null?void 0:N.name,method_id:c,success:!1,error:I})}finally{n(!1)}else g(t("notice::data-not-loaded"),{variant:"error"})},[h,e,c]);return r(D,{title:t("order.checkout.billing-card.title"),children:f(M,{spacing:2,divider:r(F,{}),children:[k.map((y,p)=>i?r(L,{variant:"text",width:"100%",height:40},p):f(M,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[r(E,{variant:"body1",children:y.label}),r(E,{variant:"body1",children:y.value})]},p)),r(w,{fullWidth:!0,variant:"contained",disabled:i||m||((v=d.data)==null?void 0:v.length)==0,onClick:s,children:t("order.checkout.billing-card.button")})]})})},ve=()=>{const{status:t}=x();return f(o,{container:!0,spacing:2,children:[r(o,{item:!0,xs:!0,children:f(o,{container:!0,spacing:2,children:[t!==a.PENDING&&r(o,{item:!0,xs:12,children:r(pe,{})}),r(o,{item:!0,xs:12,children:r(he,{})}),r(o,{item:!0,xs:12,children:r(ye,{})}),t===a.PENDING&&r(o,{item:!0,xs:12})]})}),t===a.PENDING&&r(o,{item:!0,xs:12,md:4,children:f(o,{container:!0,spacing:2,children:[r(o,{item:!0,xs:12,children:r(be,{})}),r(o,{item:!0,xs:12,children:r(ke,{})})]})})]})},Ee=()=>{le("checkout");const t=ce().id;return r(ue,{tradeNo:t||"",children:r(ve,{})})};export{Ee as default};
